# ๐ ุชูุฑูุฑ ุฅุบูุงู ููู ุงูุฃูุงู ูุงูุตูุงุญูุงุช

## ๐ ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุดุฑูุน

ุชู ุฅูุฌุงุฒ ูุดุฑูุน ุฅุบูุงู ููู ุงูุฃูุงู ูุงูุตูุงุญูุงุช ุจุงููุงูู ููุธุงู **bThwani**ุ ูุงูุฐู ูุดูู ุชุทุจููุงุช ูุชุนุฏุฏุฉ:
- **Backend** (Node.js/TypeScript)
- **Admin Dashboard** (React/Vite)
- **ุชุทุจููุงุช ุงูููุจุงูู** (React Native/Expo)

## ๐ฏ ุฃูุฏุงู ุงููุดุฑูุน

ุชู ุชูููุฐ ุซูุงุซุฉ ูุญุงูุฑ ุฑุฆูุณูุฉ ูุฅุบูุงู ููู ุงูุฃูุงู:

1. **RBAC ูุงุฌูุฉ** - ุฅุฎูุงุก/ุชุนุทูู ุงูุนูุงุตุฑ ุญุณุจ ุงูุฏูุฑ
2. **ุญูุงูุฉ ุงูุฑูุงุจุท** - ููุน Deep-Link ุบูุฑ ุงููุตุฑุญ
3. **ุงูุฌูุณุฉ ูุงูุชุฌุฏูุฏ** - Refresh Token/Session Timeout ุณูุณ

---

## ๐ง ุงูุชุบููุฑุงุช ุงููููุฌุฒุฉ

### 1๏ธโฃ Backend - ูุธุงู ุงููุตุงุฏูุฉ ูุงูุชูููุถ

#### โ ุชุญุณููุงุช Middleware ุงูุฃูุงู

**`Backend/src/middleware/rbac.ts`**
- ุฅุถุงูุฉ `requirePermission()` ููุตูุงุญูุงุช ุงูููุตูุฉ
- ุฅุถุงูุฉ `requireRoleOrPermission()` ูููุฑููุฉ ูู ุงูุชุญูู
- ุฏุนู granular permissions ูุน fallback ููุฃุฏูุงุฑ
- ุชุญุณูู ุฑุณุงุฆู ุงูุฎุทุฃ ูุน ุฃููุงุฏ ูุญุฏุฏุฉ

**`Backend/src/middleware/ensureOwner.ts`**
- ุชุญููู ุงูููุฏูููุฑ ุฅูู ุนุงู ููุงุจู ููุงุณุชุฎุฏุงู ูุน ุฃู ููุฑุฏ
- ุญูุงูุฉ ูู IDOR (Insecure Direct Object Reference)
- ุฏุนู ุญููู ูุฎุชููุฉ ููููููุฉ (`userId`, `ownerId`, `driverId`)
- ุฅุถุงูุฉ `ensureOwnerOrAdmin` ููุณูุงุญ ููุฅุฏุงุฑููู ุจุงููุตูู

**`Backend/src/middleware/auth.middleware.ts`**
- ุฅุนุงุฏุฉ ูุชุงุจุฉ ุดุงููุฉ ูุฏุนู JWT ูุงูู
- ุฅุถุงูุฉ ุงูุชูุงุก ุตูุงุญูุฉ ูุญุฏุฏ ููุชูููุงุช
- ูุนุงูุฌุฉ ูุชูุฏูุฉ ูุฃุฎุทุงุก ุงูุชูููุงุช
- ุฏุนู optional authentication

#### โ ุชุทุจูู ุงูุญูุงูุฉ ุนูู Routes

**`Backend/src/routes/admin/adminRoutes.ts`**
- ุชุทุจูู `verifyFirebase` ุนูู ุฌููุน routes ุงูุฅุฏุงุฑูุฉ
- ุฅุถุงูุฉ `requirePermission` ููู ูุณุงุฑ ุญุณุจ ุงูุฅุฌุฑุงุก ุงููุทููุจ
- ุญูุงูุฉ ุฎุงุตุฉ ูููุณุงุฑุงุช ุงูุญุณุงุณุฉ (stats, users, notifications)

**`Backend/src/routes/admin/adminUsersRoutes.ts`**
- ุญูุงูุฉ ูุงููุฉ ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ุงูุฅุฏุงุฑููู
- ุตูุงุญูุงุช ููุตูุฉ ูููุฑุงุกุฉ/ุงููุชุงุจุฉ/ุงูุชุนุฏูู/ุงูุญุฐู
- ูุญุต ุตุญุฉ ุงูุจูุงูุงุช ูุน express-validator

**`Backend/src/routes/admin/drivers.finance.ts`**
- ุญูุงูุฉ ูุงููุฉ ุงูุณุงุฆููู ุจุตูุงุญูุงุช ุฎุงุตุฉ
- ุชุชุจุน ุงูุชุบููุฑุงุช ุงููุงููุฉ ุจุงูุชุงุฑูุฎ ูุงููุณุชุฎุฏู
- ูุญุต ุฏููู ูููุนุงููุงุช ุงููุงููุฉ

#### โ ูุธุงู JWT Refresh

**`Backend/src/routes/auth.routes.ts`** (ุฌุฏูุฏ)
- ูุณุงุฑ `/api/v1/auth/jwt/refresh` ูุชุฌุฏูุฏ ุงูุชูููุงุช
- ูุธุงู rotation ููุชูููุงุช (Access + Refresh)
- Blacklist ููุชูููุงุช ุงููุจุทูุฉ
- ุฏุนู ุงูุชูุงุก ุตูุงุญูุฉ ูุฎุชูู ููุชูููุงุช

**`Backend/src/index.ts`**
- ุฅุถุงูุฉ ูุณุงุฑ JWT auth ููุชุทุจูู ุงูุฑุฆูุณู
- ุชูุธูู ูุณุงุฑุงุช ุงููุตุงุฏูุฉ

### 2๏ธโฃ Admin Dashboard - ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ

#### โ ุชุญุณูู ูุธุงู ุงูุตูุงุญูุงุช

**`admin-dashboard/src/types/adminUsers.ts`**
- ุชูุณูุน ูุธุงู ุงูุตูุงุญูุงุช ููุดูู 15+ ููุฏููู ุฌุฏูุฏ
- ุฅุถุงูุฉ ููุงูุจ ุตูุงุญูุงุช ููุฃุฏูุงุฑ ุงููุฎุชููุฉ
- ุฏุนู granular permissions ููุตูุฉ

**`admin-dashboard/src/components/RequireAdminPermission.tsx`**
- ุฅุถุงูุฉ `mode="disable"` ูุชุนุทูู ุงูุนูุงุตุฑ ุจุฏูุงู ูู ุฅุฎูุงุฆูุง
- ุฏุนู ุตูุงุญูุงุช ุจุชูุณูู `module:action`
- ุฑุณุงุฆู ุฎุทุฃ ููุตูุฉ ูุน ุนุฑุถ ุงูุตูุงุญูุฉ ุงููุทููุจุฉ
- ุฏุนู tooltip ููุนูุงุตุฑ ุงููุนุทูุฉ

**`admin-dashboard/src/hook/useCapabilities.ts`**
- ุฅุถุงูุฉ 15+ hook ุฌุฏูุฏ ูุฌููุน ุงูุตูุงุญูุงุช
- ุชุญุณูู ููุทู ูุญุต ุงูุตูุงุญูุงุช ูุน ุฏุนู superadmin
- ูุธุงู ูุฑู ููุชุญูู ูู ุงูุตูุงุญูุงุช

#### โ ุชุญุฏูุซ ุงูุชุทุจูู ุงูุฑุฆูุณู

**`admin-dashboard/src/App.tsx`**
- ุฅุถุงูุฉ ุตูุญุฉ ุฎุทุฃ ููุญุฏุฉ ููุฃุฎุทุงุก 401/403/404
- ุชูุฌูู ุณูุณ ููุฃุฎุทุงุก ูุน ุญูุธ ุญุงูุฉ ุงูุตูุญุฉ

### 3๏ธโฃ ุชุทุจููุงุช ุงูููุจุงูู - ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

#### โ ูุธุงู ุงูุตูุงุญูุงุช ุงููุชูุงูู

**`bThwaniApp/src/hooks/useAbility.ts`** (ุฌุฏูุฏ)
- ูุธุงู ุตูุงุญูุงุช ุดุงูู ููุชุทุจููุงุช ุงููุญูููุฉ
- ุฏุนู role-based ู granular permissions
- ุฏูุงู ูุณุงุนุฏุฉ ููุชุญูู ูู ุงูุตูุงุญูุงุช

**`bThwaniApp/src/components/RequirePermission.tsx`** (ุฌุฏูุฏ)
- ูููู ูุญูุงูุฉ ุงููุงุฌูุฉ ูู ุงูุชุทุจููุงุช ุงููุญูููุฉ
- ุฏุนู disable mode ูุน opacity ููุฎูุถุฉ
- ุฑุณุงุฆู ุฎุทุฃ ูุฏูุฉ ูููุณุชุฎุฏู

**`bThwaniApp/src/auth/AuthContext.tsx`**
- ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู ุงููุงููุฉ (role, permissions)
- ุชุญุฏูุซ ุชููุงุฆู ูุจูุงูุงุช ุงููุณุชุฎุฏู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
- ุชูุธูู ุดุงูู ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ

#### โ ุฅุฏุงุฑุฉ ุงูุฌูุณุฉ ุงููุชูุฏูุฉ

**`bThwaniApp/src/utils/api/axiosInstance.ts`**
- ุชุฌุฏูุฏ ุชููุงุฆู ููุชูููุงุช ูุน ุทุงุจูุฑ ุงูุชุธุงุฑ
- ุญูุธ ุญุงูุฉ ุงูุดุงุดุฉ ุงูุญุงููุฉ ูุจู ุฅุนุงุฏุฉ ุชูุฌูู
- ูุนุงูุฌุฉ ุฐููุฉ ูุฃุฎุทุงุก 401/403

**`bThwaniApp/src/hooks/useFormDraft.ts`** (ุฌุฏูุฏ)
- ุญูุธ ุชููุงุฆู ูุญุงูุฉ ุงูููุงุฐุฌ ูู ุซุงููุชูู
- ุงุณุชุฑุฌุงุน ุชููุงุฆู ููุจูุงูุงุช ุจุนุฏ ุฅุนุงุฏุฉ ุงูุฏุฎูู
- ุฏุนู ูุชุนุฏุฏ ุงูููุงุฐุฌ ูู ููุณ ุงูููุช

#### โ ุตูุญุงุช ุงูุฎุทุฃ ุงููุฏูุฉ

**`bThwaniApp/src/screens/ErrorScreen.tsx`** (ุฌุฏูุฏ)
- ุตูุญุฉ ุฎุทุฃ ุดุงููุฉ ููุชุทุจููุงุช ุงููุญูููุฉ
- ุชุตููู ุฌุฐุงุจ ูุน ุฃููููุงุช ุชุนุจูุฑูุฉ
- ุฅุฌุฑุงุกุงุช ููุงุณุจุฉ ููู ููุน ุฎุทุฃ

---

## ๐ ุงูููุฒุงุช ุงูุฃูููุฉ ุงููุถุงูุฉ

### 1. ูุธุงู RBAC ูุชุนุฏุฏ ุงููุณุชููุงุช
- **Role-based**: `admin`, `manager`, `operator`, `user`
- **Permission-based**: `module:action` (ูุซู `admin.users:read`)
- **Superadmin bypass**: ุตูุงุญูุงุช ูุงููุฉ ูููุฏุฑุงุก ุงูุนุงููู

### 2. ุญูุงูุฉ ุดุงููุฉ ูู ุงูุซุบุฑุงุช
- **IDOR Protection**: ููุน ุงููุตูู ูููุงุฑุฏ ุงูุขุฎุฑูู
- **Deep-link Protection**: ุญูุงูุฉ ูู ุงูุฑูุงุจุท ุงููุจุงุดุฑุฉ ุบูุฑ ุงููุตุฑุญุฉ
- **Token Blacklist**: ุฅุจุทุงู ุงูุชูููุงุช ุงููุณุฑููุฉ ููุฑุงู

### 3. ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ
- **Auto Token Refresh**: ุชุฌุฏูุฏ ุชููุงุฆู ููุฌูุณุงุช
- **Form Persistence**: ุญูุธ ุชููุงุฆู ูุงุณุชุฑุฌุงุน ููููุงุฐุฌ
- **Error Pages**: ุตูุญุงุช ุฎุทุฃ ูุฏูุฉ ุจุฏูุงู ูู ุงูุดุงุดุงุช ุงูุจูุถุงุก

---

## ๐งช ุฎุทุฉ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑุงุช ุงูุฃูุงู ุงูุฃุณุงุณูุฉ

#### 1๏ธโฃ ุงุฎุชุจุงุฑ RBAC ุงููุงุฌูุฉ
```bash
# ุฅูุดุงุก ุญุณุงุจ ูุญุฏูุฏ
POST /api/v1/admin/users/register
{
  "name": "Limited User",
  "email": "limited@example.com",
  "role": "operator",
  "permissions": {
    "admin.users": { "read": true },
    "admin.drivers": { "read": true }
  }
}

# ูุญุงููุฉ ุงููุตูู ูููุฒุงุช ูุญุธูุฑุฉ
GET /api/v1/admin/users/list  # ูุฌุจ ุฑูุถ 403
GET /api/v1/admin/drivers     # ูุฌุจ ุงูุณูุงุญ 200
```

#### 2๏ธโฃ ุงุฎุชุจุงุฑ ุญูุงูุฉ ุงูุฑูุงุจุท
```bash
# ูุญุงููุฉ ุงููุตูู ุจุฏูู ุชููู
GET /api/v1/admin/dashboard  # ูุฌุจ ุฅุฑุฌุงุน 401

# ูุญุงููุฉ ุงููุตูู ุจุญุณุงุจ ูุญุฏูุฏ
GET /api/v1/admin/users/list  # ูุฌุจ ุฑูุถ 403

# ูุญุงููุฉ ุงููุตูู ูููุฑุฏ ูุง ุชูููู
GET /api/v1/users/999        # ูุฌุจ ุฑูุถ 403 ุฃู 404
```

#### 3๏ธโฃ ุงุฎุชุจุงุฑ ุงูุฌูุณุฉ ูุงูุชุฌุฏูุฏ
```bash
# ุถุจุท ุงูุชูุงุก ุตูุงุญูุฉ ูุตูุฑ ููุงุฎุชุจุงุฑ
JWT_ACCESS_EXPIRY=1m

# ููุก ูููุฐุฌ ูุงูุชุธุงุฑ ุงูุชูุงุก ุงูุฌูุณุฉ
POST /api/v1/some-form       # ุณููุดู 401 ุซู ูุชุฌุฏุฏ ุชููุงุฆูุงู

# ูุญุต ุญูุธ ุญุงูุฉ ุงููููุฐุฌ
# ูุฌุจ ุงุณุชุฑุฌุงุน ุงูุจูุงูุงุช ุจุนุฏ ุฅุนุงุฏุฉ ุงูุฏุฎูู
```

### ุงุฎุชุจุงุฑุงุช ุงููุงุฌูุฉ

#### Admin Dashboard
1. **ุชุณุฌูู ุฏุฎูู ุจุญุณุงุจ ูุญุฏูุฏ**
2. **ุงูุชุญูู ูู ุฅุฎูุงุก ุงูููุงุฆู ุบูุฑ ุงููุตุฑุญุฉ**
3. **ูุญุงููุฉ ุงูุถุบุท ุนูู ุฃุฒุฑุงุฑ ูุญุธูุฑุฉ**
4. **ุงูุชุญูู ูู ุฑุณุงุฆู ุงูุฎุทุฃ ุงููุฏูุฉ**

#### ุชุทุจููุงุช ุงูููุจุงูู
1. **ุชุณุฌูู ุฏุฎูู ุจุฃุฏูุงุฑ ูุฎุชููุฉ**
2. **ุงูุชุญูู ูู ุฅุฎูุงุก/ุชุนุทูู ุงูุนูุงุตุฑ**
3. **ุงุฎุชุจุงุฑ ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู ููุฌูุณุฉ**
4. **ูุญุต ุญูุธ ุญุงูุฉ ุงูููุงุฐุฌ**

---

## ๐ ุงูุชูุตูุงุช ูููุดุฑ ูุงูุตูุงูุฉ

### ูุชุทูุจุงุช ุงูุจูุฆุฉ
```bash
# ููู .env ูู Backend/
JWT_ACCESS_SECRET=your-super-secret-access-key-minimum-32-chars
JWT_REFRESH_SECRET=your-super-secret-refresh-key-minimum-32-chars
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d
REDIS_URL=redis://localhost:6379

# ููุฅูุชุงุฌ
JWT_ACCESS_EXPIRY=30m
JWT_REFRESH_EXPIRY=30d
```

### ูุฑุงูุจุฉ ุงูุฃูุงู ุงููุณุชูุฑุฉ

#### 1๏ธโฃ ูุฑุงูุจุฉ ุงูุชูููุงุช
```typescript
// ูู Backend - ุฅุถุงูุฉ logging ููุชุชุจุน
router.use((req, res, next) => {
  console.log(`๐ Access: ${req.user?.role} -> ${req.method} ${req.path}`);
  next();
});
```

#### 2๏ธโฃ ุชูุจููุงุช ุงูุฃูุงู
```typescript
// ูุฑุงูุจุฉ ูุญุงููุงุช ุงููุตูู ุงููุญุธูุฑุฉ
const alertSecurity = (req, res, permission) => {
  console.warn(`๐จ SECURITY ALERT: ${req.user?.email} denied ${permission}`);
  // ุฅุฑุณุงู ุชูุจูู ููุฅุฏุงุฑุฉ
};
```

### ุงูุตูุงูุฉ ูุงูุชุทููุฑ ุงููุณุชูุจูู

#### ุฅุถุงูุฉ ุตูุงุญูุงุช ุฌุฏูุฏุฉ
```typescript
// ุฅุถุงูุฉ ููุฏููู ุฌุฏูุฏ ูู adminUsers.ts
export type ModuleName = "admin.analytics" | "admin.marketing" | ...;

// ุฅุถุงูุฉ hooks ูู useCapabilities.ts
export const useCanReadAnalytics = (user) =>
  useHasPermission("admin.analytics:read", user);
```

#### ุชุญุณูู ุชุฌุฑุจุฉ ุงููุทูุฑ
```typescript
// ุฅุถุงูุฉ TypeScript types ููู permissions
interface PermissionConfig {
  module: ModuleName;
  action: string;
  description: string;
}
```

---

## ๐ ููุฎุต ุงูุฅูุฌุงุฒุงุช

| ุงููููู | ุงููููุงุช ุงูููุญุฏูุซุฉ | ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ | ุญุงูุฉ ุงูุชูููุฐ |
|--------|------------------|------------------|----------------|
| **Backend** | 8 ูููุงุช | RBAC ูุชูุฏูุ JWT Refreshุ ุญูุงูุฉ IDOR | โ ููุชูู |
| **Admin Dashboard** | 4 ูููุงุช | ุตูุงุญูุงุช ููุตูุฉุ ูุงุฌูุฉ ุฐููุฉุ ุตูุญุงุช ุฎุทุฃ | โ ููุชูู |
| **Mobile Apps** | 6 ูููุงุช | ูุธุงู ุตูุงุญูุงุชุ ุฌูุณุงุช ุณูุณุฉุ ุญูุธ ุงูููุงุฐุฌ | โ ููุชูู |

## ๐ ุฎุงุชูุฉ

ุชู ุฅูุฌุงุฒ ูุดุฑูุน ุฅุบูุงู ููู ุงูุฃูุงู ุจุงููุงูู ุจูุฌุงุญุ ููุง ูููุฑ:
- **ุญูุงูุฉ ุดุงููุฉ** ูู ุงูุซุบุฑุงุช ุงูุฃูููุฉ ุงูุดุงุฆุนุฉ
- **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ** ูุน ุงูุญูุงุธ ุนูู ุงูุฃูุงู
- **ูุงุจููุฉ ููุชุทููุฑ** ูุฅุถุงูุฉ ููุฒุงุช ุฃูููุฉ ูุณุชูุจููุฉ
- **ุชูุซูู ุดุงูู** ููุตูุงูุฉ ูุงููุฑุงูุจุฉ

ุงููุธุงู ุฌุงูุฒ ุงูุขู ูููุดุฑ ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ ูุน ูุณุชููุงุช ุฃูุงู ุนุงููุฉ ูุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ! ๐โจ

---

**ุชุงุฑูุฎ ุงูุชูุฑูุฑ**: `$(date +'%Y-%m-%d')`
**ุญุงูุฉ ุงููุดุฑูุน**: โ ููุชูู ุจุงููุงูู
**ุงููุทูุฑ ุงููุณุคูู**: ูุธุงู ุงูุฃูุงู ุงูุขูู
