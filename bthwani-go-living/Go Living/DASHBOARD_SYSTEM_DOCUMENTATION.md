# ูุธุงู ููุญุฉ ุงูุชุญูู - Bthwani Platform

## ูููู ุงููุธุงู ูุงูุนูููุงุช ุงูุฃุณุงุณูุฉ

### 1. ููุญุฉ ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ (Admin Overview Dashboard)

#### **ุงููููุน**: `/admin/overview`
#### **ุงูููู ุงูุฑุฆูุณู**: `admin-dashboard/src/pages/admin/OverviewPage.tsx`

#### **ุงูุนูููุงุช ุงูุฑุฆูุณูุฉ**:

**๐น ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณูุฉ (KPIs):**
- `ุนุฏุฏ ุงูุทูุจุงุช`: ุฅุฌูุงูู ุงูุทูุจุงุช ูู ุงููุชุฑุฉ ุงููุญุฏุฏุฉ
- `GMV`: ุฅุฌูุงูู ูููุฉ ุงูุจุถุงุฆุน ุงููุจุงุนุฉ (ุณุนุฑ ุงูููุชุฌุงุช + ุฑุณูู ุงูุชูุตูู)
- `ุฅูุฑุงุฏ ุงูููุตุฉ`: ุนูููุฉ ุงูููุตุฉ ูู ุงูุทูุจุงุช
- `ูุนุฏู ุงูุฅูุบุงุก`: ูุณุจุฉ ุงูุทูุจุงุช ุงูููุบุงุฉ
- `ุฒูู ุงูุชูุตูู`: ูุชูุณุท ููุช ุงูุชูุตูู (ูุชูุณุท/90%)

**๐น ุนูุงูู ุงูุชุตููุฉ:**
- **ุงูููุทูุฉ ุงูุฒูููุฉ**: `Asia/Aden`, `Asia/Riyadh`, `UTC`
- **ูุทุงู ุงูุชุงุฑูุฎ**: `from` - `to` (YYYY-MM-DD)
- **ุชุญุฏูุซ ููุฑู**: ุฒุฑ ุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช

**๐น ุงูุฑุณูู ุงูุจูุงููุฉ ุงูุชูุงุนููุฉ:**
```typescript
// ุงูุณูุณูุฉ ุงูุฒูููุฉ
metric: "orders" | "gmv" | "revenue"
interval: "day" | "hour"
// ุฑุณู ููุทูุฉ ูุน ุชุฏุฑุฌ ูููู
```

**๐น ุฌุฏูู ุฃูุถู ุงูุฃุฏุงุก:**
```typescript
by: "stores" | "cities" | "categories"
limit: 10
// ููุงููุณ: ุงูุทูุจุงุชุ GMVุ ุงูุฅูุฑุงุฏ
```

**๐น ุงูุชูุจููุงุช ุงูุณุฑูุนุฉ:**
- `ุทูุจุงุช ุจุงูุชุธุงุฑ ุงูุดุฑุงุก`
- `ุทูุจุงุช ุจุงูุชุธุงุฑ ุงูุฅุณูุงุฏ ููุงุจุชู`
- `ุทูุจุงุช ูุชุฃุฎุฑุฉ ูู ุงูุชูุตูู (>90 ุฏูููุฉ)`

### 2. ููุญุฉ ุงูุชุณููู (Marketing Dashboard)

#### **ุงููููุน**: `/marketing/dashboard`
#### **ุงูููู ุงูุฑุฆูุณู**: `admin-dashboard/src/pages/marketing/Dashboard.tsx`

#### **ุงูุนูููุงุช ุงูุฑุฆูุณูุฉ**:

**๐น ูุคุดุฑุงุช ุนุงุฆุฏ ุงูุฅููุงู ุงูุฅุนูุงูู (ROAS):**
```typescript
interface RoasPoint {
  day: string;
  revenue: number;
  cost: number;
  conversions: number;
  roas: number;
  cpa: number;
}
```

**๐น ุนูุงูู ุงูุชุตููุฉ:**
- **ูุทุงู ุงูุชุงุฑูุฎ**: `from` - `to`
- **ุงูุชุฌููุน**: `source` | `campaign` | `none`

**๐น ุงูุญุณุงุจุงุช:**
```typescript
const totals = {
  rev: sum(revenue),
  cost: sum(cost),
  conv: sum(conversions)
};
const roas = cost > 0 ? rev / cost : Infinity;
```

### 3. ููุญุฉ ุนูููุงุช ุงูุณุงุฆููู (Ops Drivers Dashboard)

#### **ุงููููุน**: `/admin/ops/drivers`
#### **ุงูููู ุงูุฑุฆูุณู**: `admin-dashboard/src/pages/admin/ops/OpsDriversDashboard.tsx`

#### **ุงูุนูููุงุช ุงูุฑุฆูุณูุฉ**:

**๐น ุงูุงุชุตุงู ุงูููุฑู:**
```typescript
// WebSocket ูุน Fallback ุฅูู Polling
const wsUrl = `ws://${location.host}/ws/admin/ops/drivers`;
const pollInterval = 4000; // 4 ุซูุงูู
```

**๐น ูููู ุจูุงูุงุช ุงูุณุงุฆู:**
```typescript
interface DriverRT {
  id: string;
  name: string;
  phone?: string;
  status: "online" | "busy" | "idle" | "offline";
  lat: number;
  lng: number;
  speed?: number;
  lastSeen: string;
  orderId?: string | null;
  city?: string;
  slaBreached?: boolean;
}
```

**๐น ุงูุฅุฌุฑุงุกุงุช ุงูุชุดุบูููุฉ:**
```typescript
action: "lock" | "ping" | "notify"
```

**๐น ุงูุชูุจููุงุช ุงูุชุดุบูููุฉ:**
- `ูุจุงุชู ุบูุฑ ูุชุตููู`: ูุฑุงูุจุฉ ููุฏุงู ุงูุงุชุตุงู
- `ุฎุฑู SLA`: ุทูุจุงุช ูุชุฃุฎุฑุฉ ูู ุงูุชูุตูู
- `ูุซุงูุฉ ุทูุจุงุช ุนุงููุฉ`: ุนูุฏูุง ุชููู >70% ูู ุงูุณุงุฆููู ูุดุบูููู

### 4. ููุญุฉ ุงูุชูุงุฑูุฑ (Reports Dashboard)

#### **ุงููููุน**: `/admin/reports`
#### **ุงูููู ุงูุฑุฆูุณู**: `admin-dashboard/src/pages/admin/ReportsDashboardPage.tsx`

#### **ุงูุนูููุงุช ุงูุฑุฆูุณูุฉ**:

**๐น ุงูููุงููุณ ุงููุญุธูุฉ:**
```typescript
interface RealtimeMetrics {
  activeUsers: number;
  currentOrders: number;
  revenueToday: number;
  systemHealth: "healthy" | "warning" | "critical";
}
```

**๐น ุนูุงูู ุงูุชุตููุฉ ุงููุชูุฏูุฉ:**
- **ูุทุงู ุงูุชุงุฑูุฎ**: ูุญุฏุฏ ุจุฏูุฉ ุจุงุณุชุฎุฏุงู `DatePicker`
- **ุงููุชุฑุฉ**: `daily` | `weekly` | `monthly` | `quarterly` | `yearly`
- **ุงูุชุตุฏูุฑ**: ุฅููุงููุฉ ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ ุงูุดุงููุฉ

## ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช (APIs)

### 1. ููุญุฉ ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ

#### `GET /admin/dashboard/summary`
**ุงููุนุทูุงุช**:
```typescript
{
  from: string;    // YYYY-MM-DD
  to: string;      // YYYY-MM-DD
  tz: string;      // Asia/Aden | Asia/Riyadh | UTC
}
```

**ุงูุงุณุชุฌุงุจุฉ**:
```typescript
{
  range: { from: string, to: string },
  users: number,
  drivers: number,
  stores: number,
  orders: number,
  gmv: number,
  revenue: number,
  cancelRate: number,
  deliveryTime: {
    avgMin: number | null,
    p90Min: number | null
  },
  byStatus: Array<{status: string, count: number}>
}
```

#### `GET /admin/dashboard/timeseries`
**ุงููุนุทูุงุช**:
```typescript
{
  from: string,
  to: string,
  tz: string,
  metric: "orders" | "gmv" | "revenue",
  interval: "day" | "hour"
}
```

#### `GET /admin/dashboard/top`
**ุงููุนุทูุงุช**:
```typescript
{
  from: string,
  to: string,
  tz: string,
  by: "stores" | "cities" | "categories",
  limit: number // ุงูุชุฑุงุถู 10
}
```

### 2. ุนูููุงุช ุงูุณุงุฆููู

#### `GET /admin/ops/drivers/realtime`
**ุงูุงุณุชุฌุงุจุฉ**:
```typescript
{
  drivers: Array<{
    id: string,
    name: string,
    status: "online" | "busy" | "idle" | "offline",
    lat: number,
    lng: number,
    lastSeen: string,
    slaBreached?: boolean
  }>
}
```

#### `POST /admin/ops/drivers/{id}/actions`
**ุงููุนุทูุงุช**:
```typescript
{
  action: "lock" | "ping" | "notify",
  reason?: string
}
```

## ููุงุฐุฌ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ

### ูููุฐุฌ ุงูุทูุจุงุช (Order)
```typescript
{
  _id: ObjectId,
  user: ObjectId,
  store: ObjectId,
  driver?: ObjectId,
  status: "placed" | "awaiting_procurement" | "procured" | "out_for_delivery" | "delivered" | "cancelled",
  items: Array<{
    product: ObjectId,
    quantity: number,
    price: number
  }>,
  price: number,
  deliveryFee: number,
  platformShare: number,
  address: {
    city: string,
    coordinates: [number, number]
  },
  createdAt: Date,
  deliveredAt?: Date
}
```

### ูููุฐุฌ ุงูุณุงุฆููู (Driver)
```typescript
{
  _id: ObjectId,
  user: ObjectId,
  status: "online" | "busy" | "idle" | "offline",
  currentLocation: {
    lat: number,
    lng: number,
    lastUpdated: Date
  },
  documents: Array<{
    type: "license" | "vehicle" | "insurance",
    expiryDate: Date,
    status: "valid" | "expiring" | "expired"
  }>,
  totalDeliveries: number
}
```

## ุขููุงุช ุงูุนูู ุงูุฃุณุงุณูุฉ

### 1. ูุฑุงูุจุฉ ุงูุฃุฏุงุก
**ุญุณุงุจ GMV:**
```javascript
const gmvExpr = { $add: ["$price", { $ifNull: ["$deliveryFee", 0] }] };
```

**ุญุณุงุจ ุฒูู ุงูุชูุตูู:**
```javascript
{
  $project: {
    deliveryMin: {
      $divide: [
        { $subtract: ["$deliveredAt", "$createdAt"] },
        1000 * 60
      ]
    }
  }
}
```

### 2. ูุธุงู ุงูุชูุจููุงุช
**ุงูุทูุจุงุช ุงููุชุฃุฎุฑุฉ:**
```javascript
{
  status: "out_for_delivery",
  createdAt: { $lt: new Date(now.getTime() - 1000 * 60 * 90) }
}
```

### 3. ุงูุงุชุตุงู ุงูููุฑู
**WebSocket ูุน Fallback:**
```javascript
const ws = new WebSocket(wsUrl);
ws.onmessage = (evt) => {
  const payload = JSON.parse(evt.data);
  if (Array.isArray(payload?.drivers)) {
    updateDrivers(payload.drivers);
  }
};
```

## ูููู ุงููุดุฑูุน ุงููุฑูุฒ

```
admin-dashboard/src/pages/
โโโ admin/
โ   โโโ OverviewPage.tsx          # ููุญุฉ ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ
โโโ marketing/
โ   โโโ Dashboard.tsx             # ููุญุฉ ุงูุชุณููู
โโโ drivers/
โ   โโโ Dashboard.tsx             # ููุญุฉ ุงูุณุงุฆููู
โโโ admin/ops/
โ   โโโ OpsDriversDashboard.tsx   # ุนูููุงุช ุงูุณุงุฆููู
โโโ admin/
    โโโ ReportsDashboardPage.tsx  # ููุญุฉ ุงูุชูุงุฑูุฑ

Backend/src/
โโโ controllers/admin/
โ   โโโ dashboard.controller.ts   # ููุทู ููุญุฉ ุงูุฅุฏุงุฑุฉ
โโโ routes/admin/
โ   โโโ dashboardOverview.routes.ts # ูุณุงุฑุงุช ููุญุฉ ุงูุฅุฏุงุฑุฉ
โโโ models/
    โโโ Order.ts                  # ูููุฐุฌ ุงูุทูุจุงุช
    โโโ Driver.ts                 # ูููุฐุฌ ุงูุณุงุฆููู
    โโโ DeliveryStore.ts          # ูููุฐุฌ ุงููุชุงุฌุฑ
```

ูุฐุง ุงูุชูุซูู ูุฑูุฒ ุนูู ุงูุนูุงุตุฑ ุงูุฃุณุงุณูุฉ ูุงูุนูููุงุช ุงููุนููุฉ ุงูุชู ูููู ุจูุง ูู ูููู ูู ุงููุธุงู.

## ููุญุงุช ุงูุชุญูู ูุงููุงุฌูุงุช

### 1. ููุญุฉ ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ (Admin Overview Dashboard)

#### ุงููููุน ูุงููุตูู
- **ุงููุณุงุฑ**: `/admin/overview`
- **ุงูููู**: `admin-dashboard/src/pages/admin/OverviewPage.tsx`
- **ุงูุฃุฐููุงุช ุงููุทููุจุฉ**: ูุณุคูู ุงููุธุงู

#### ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

##### ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุฑุฆูุณูุฉ (KPIs)
- **ุนุฏุฏ ุงูุทูุจุงุช**: ุฅุฌูุงูู ุงูุทูุจุงุช ูู ุงููุชุฑุฉ ุงููุญุฏุฏุฉ
- **GMV (Gross Merchandise Value)**: ุฅุฌูุงูู ูููุฉ ุงูุจุถุงุฆุน ุงููุจุงุนุฉ
- **ุฅูุฑุงุฏ ุงูููุตุฉ**: ุนูููุฉ ุงูููุตุฉ ูู ุงูุทูุจุงุช
- **ูุนุฏู ุงูุฅูุบุงุก**: ูุณุจุฉ ุงูุทูุจุงุช ุงูููุบุงุฉ
- **ุฒูู ุงูุชูุตูู**: ูุชูุณุท ููุช ุงูุชูุตูู (ูุชูุณุท/90%)

##### ุนูุงูู ุงูุชุตููุฉ ูุงูุชุฎุตูุต
- **ุงูููุทูุฉ ุงูุฒูููุฉ**: Asia/Aden, Asia/Riyadh, UTC
- **ูุทุงู ุงูุชุงุฑูุฎ**: ูู ุชุงุฑูุฎ - ุฅูู ุชุงุฑูุฎ
- **ุชุญุฏูุซ ููุฑู**: ุฒุฑ ูุชุญุฏูุซ ุงูุจูุงูุงุช

##### ุงูุฑุณูู ุงูุจูุงููุฉ ุงูุชูุงุนููุฉ
- **ุงูุณูุณูุฉ ุงูุฒูููุฉ**: ุฑุณู ุจูุงูู ููุฃุฏุงุก ุญุณุจ ุงููุชุฑุฉ
- **ููุน ุงููููุงุณ**: ุงูุทูุจุงุชุ GMVุ ุงูุฅูุฑุงุฏ
- **ุงููุงุตู ุงูุฒููู**: ููููุ ุณุงุนู
- **ููุน ุงูุฑุณู**: ููุทูุฉ ูุน ุชุฏุฑุฌ ูููู

##### ุฌุฏูู ุฃูุถู ุงูุฃุฏุงุก
- **ุชุตููู ุญุณุจ**: ุงููุชุงุฌุฑุ ุงููุฏูุ ุงูุชุตูููุงุช
- **ุงูููุงููุณ**: ุงูุทูุจุงุชุ GMVุ ุงูุฅูุฑุงุฏ
- **ุงูุญุฏ ุงูุฃูุตู**: 10 ุนูุงุตุฑ

##### ุงูุชูุจููุงุช ุงูุณุฑูุนุฉ
- **ุทูุจุงุช ุจุงูุชุธุงุฑ ุงูุดุฑุงุก**
- **ุทูุจุงุช ุจุงูุชุธุงุฑ ุงูุฅุณูุงุฏ ููุงุจุชู**
- **ุทูุจุงุช ูุชุฃุฎุฑุฉ ูู ุงูุชูุตูู (>90 ุฏูููุฉ)**

##### ุชูุฒูุน ุงูุญุงูุงุช
- ุฌุฏูู ููุถุญ ุชูุฒูุน ุญุงูุงุช ุงูุทูุจุงุช ูู ุงููุชุฑุฉ ุงููุญุฏุฏุฉ

### 2. ููุญุฉ ุงูุชุณููู (Marketing Dashboard)

#### ุงููููุน ูุงููุตูู
- **ุงููุณุงุฑ**: `/marketing/dashboard`
- **ุงูููู**: `admin-dashboard/src/pages/marketing/Dashboard.tsx`
- **ุงูุฃุฐููุงุช ุงููุทููุจุฉ**: ูุฑูู ุงูุชุณููู

#### ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

##### ูุคุดุฑุงุช ุนุงุฆุฏ ุงูุฅููุงู ุงูุฅุนูุงูู (ROAS)
- **ุงูุฅูุฑุงุฏุงุช**: ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช ูู ุงูุญููุงุช
- **ุฅููุงู ุงูุฅุนูุงูุงุช**: ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ ููุฅุนูุงูุงุช
- **ุงูุชุญูููุงุช**: ุนุฏุฏ ุงูุชุญูููุงุช ุงููุงุชุฌุฉ
- **ุนุงุฆุฏ ุงูุฅููุงู ุงูุฅุนูุงูู**: ROAS = ุงูุฅูุฑุงุฏุงุช รท ุงูุชูููุฉ

##### ุนูุงูู ุงูุชุตููุฉ
- **ูุทุงู ุงูุชุงุฑูุฎ**: ูู ุชุงุฑูุฎ - ุฅูู ุชุงุฑูุฎ
- **ุงูุชุฌููุน**: ุญุณุจ ุงููุตุฏุฑุ ุงูุญููุฉุ ุจุฏูู ุชุฌููุน

##### ุงูุฑุณูู ุงูุจูุงููุฉ
- **ุงูุฅูุฑุงุฏุงุช ููุงุจู ุงูุฅููุงู**: ุฑุณู ุจูุงูู ุฎุทู ููุงุฑู
- **ุงูุจูุงูุงุช**: ููุงุท ROAS ูุน ุงูุชูุงุตูู ุงูููููุฉ

### 3. ููุญุฉ ุงูุณุงุฆููู (Drivers Dashboard)

#### ุงููููุน ูุงููุตูู
- **ุงููุณุงุฑ**: `/drivers/dashboard`
- **ุงูููู**: `admin-dashboard/src/pages/drivers/Dashboard.tsx`
- **ุงูุฃุฐููุงุช ุงููุทููุจุฉ**: ูุฑูู ุงูุนูููุงุช

#### ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

##### ูุฑุงูุจุฉ ุงูุงูุชุซุงู
- **ูุซุงุฆู ุชูุชูู ุฎูุงู 30 ููู**: ุนุฏุฏ ุงููุซุงุฆู ุงูููุจูุฉ ุนูู ุงูุงูุชูุงุก
- **ุขุฎุฑ ุชุฌููุน ุญุถูุฑ**: ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ ููุญุถูุฑ
- **ุขุฎุฑ ูุณู ุดูุช**: ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ ูููุฑุฏูุงุช

##### ุนูุงูู ุงูุชุตููุฉ
- **ุงูุจุญุซ**: ุจุงูุงุณู ุฃู ุฑูู ุงููุงุชู
- **ุงูุญุงูุฉ**: ูุชุตูุ ูุดุบููุ ุฎุงููุ ุบูุฑ ูุชุตู
- **ุงููุฏููุฉ**: ุชุตููุฉ ุญุณุจ ุงููุฏููุฉ

### 4. ููุญุฉ ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช (Reports Dashboard)

#### ุงููููุน ูุงููุตูู
- **ุงููุณุงุฑ**: `/admin/reports`
- **ุงูููู**: `admin-dashboard/src/pages/admin/ReportsDashboardPage.tsx`
- **ุงูุฃุฐููุงุช ุงููุทููุจุฉ**: ูุณุคูู ุงููุธุงูุ ูุญูู ุงูุจูุงูุงุช

#### ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

##### ุงูููุงููุณ ุงููุญุธูุฉ
- **ุงููุณุชุฎุฏููู ุงููุดุทูู**: ุงูุนุฏุฏ ุงูุญุงูู ูููุณุชุฎุฏููู ุงููุดุทูู
- **ุงูุทูุจุงุช ุงูุญุงููุฉ**: ุนุฏุฏ ุงูุทูุจุงุช ููุฏ ุงูุชูููุฐ
- **ุงูุฅูุฑุงุฏุงุช ุงูููู**: ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช ููุฐุง ุงูููู
- **ุญุงูุฉ ุงููุธุงู**: ุณูููุ ุชุญุฐูุฑุ ุญุฑุฌ

##### ุนูุงูู ุงูุชุตููุฉ ุงููุชูุฏูุฉ
- **ูุทุงู ุงูุชุงุฑูุฎ**: ูุญุฏุฏ ุจุฏูุฉ ุจุงุณุชุฎุฏุงู ููุชูู ุงูุชุงุฑูุฎ
- **ุงููุชุฑุฉ**: ููููุ ุฃุณุจูุนูุ ุดูุฑูุ ุฑุจุน ุณูููุ ุณููู
- **ุงูุชุตุฏูุฑ**: ุฅููุงููุฉ ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ ุงูุดุงููุฉ

##### ุงูุชุญูููุงุช ุงููุงููุฉ
- **ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช**: ุงูุฅูุฑุงุฏุงุช ุงูุฅุฌูุงููุฉ ูู ุงููุชุฑุฉ
- **ุตุงูู ุงูุฑุจุญ**: ุงูุฃุฑุจุงุญ ุจุนุฏ ุฎุตู ุงูุชูุงููู
- **ุงููุณุชูุทูุงุช ุงููุนููุฉ**: ุงููุฏููุนุงุช ุงููุนููุฉ ููุชุฌุงุฑ

##### ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช
- **ุฅุฌูุงูู ุงูุทูุจุงุช**: ุนุฏุฏ ุฌููุน ุงูุทูุจุงุช
- **ูุชูุณุท ูููุฉ ุงูุทูุจ**: AOV
- **ุงูุทูุจุงุช ุงูููุชููุฉ**: ูุณุจุฉ ุงููุฌุงุญ

##### ุชุญูููุงุช ุงููุณุชุฎุฏููู
- **ุฅุฌูุงูู ุงููุณุชุฎุฏููู**: ูุงุนุฏุฉ ุงููุณุชุฎุฏููู ุงููุงููุฉ
- **ุงููุณุชุฎุฏููู ุงููุดุทูู**: ุงููุณุชุฎุฏููู ุงููุดุทูู ุญุงููุงู
- **ุงููุณุชุฎุฏููู ุงูุฌุฏุฏ**: ุงููุณุชุฎุฏููู ุงููุณุฌููู ุญุฏูุซุงู

##### ุชุญูููุงุช ุงูุชุฌุงุฑ
- **ุฅุฌูุงูู ุงูุชุฌุงุฑ**: ุนุฏุฏ ุงูุชุฌุงุฑ ุงููุณุฌููู
- **ุงูุชุฌุงุฑ ุงููุดุทูู**: ุงูุชุฌุงุฑ ุฐูู ุงููุดุงุท ุงูุญุงูู
- **ูุชูุณุท ุงูุชูููู**: ุฑุถุง ุงูุนููุงุก ุนู ุงูุชุฌุงุฑ

##### ุชุญูููุงุช ุงูุณุงุฆููู
- **ุฅุฌูุงูู ุงูุณุงุฆููู**: ุนุฏุฏ ุงูุณุงุฆููู ุงููุณุฌููู
- **ุงูุณุงุฆููู ุงููุดุทูู**: ุงูุณุงุฆููู ุงููุชุงุญูู ููุนูู
- **ุงูุชูุตููุงุช ุงูููุชููุฉ**: ุฅูุฌุงุฒุงุช ุงูุณุงุฆููู

##### ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุธุงู
- **ุฅุฌูุงูู ุงููุณุชุฎุฏููู**
- **ุฅุฌูุงูู ุงูุทูุจุงุช**
- **ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช**
- **ุงูููู ุงูุดูุฑู**

##### ุฃูุถู ุงูุฃุฏุงุก
- **ุฃูุถู ุงููุชุงุฌุฑ ุฃุฏุงุกู**: ุญุณุจ ุงูุทูุจุงุช ูุงูุฅูุฑุงุฏุงุช
- **ุฃูุถู ุงูุนููุงุก**: ุญุณุจ ุงูุทูุจุงุช ูุงูุฅููุงู

### 5. ููุญุฉ ุนูููุงุช ุงูุณุงุฆููู (Ops Drivers Dashboard)

#### ุงููููุน ูุงููุตูู
- **ุงููุณุงุฑ**: `/admin/ops/drivers`
- **ุงูููู**: `admin-dashboard/src/pages/admin/ops/OpsDriversDashboard.tsx`
- **ุงูุฃุฐููุงุช ุงููุทููุจุฉ**: ูุฑูู ุงูุนูููุงุชุ ุงููุดุฑููู

#### ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

##### ุงูุงุชุตุงู ุงูููุฑู
- **WebSocket ูุน Fallback**: ุงุชุตุงู ููุฑู ูุน Polling ุงุญุชูุงุทู
- **ุชุญุฏูุซ ุชููุงุฆู**: ุชุญุฏูุซ ูู 4 ุซูุงูู
- **ุญุงูุฉ ุงูุงุชุตุงู**: ูุคุดุฑ ูุญุงูุฉ ุงูุงุชุตุงู ุจุงููุตุฏุฑ ุงููุญุธู

##### ุนูุงูู ุงูุชุตููุฉ ูุงููุฑุงูุจุฉ
- **ุงูุจุญุซ**: ุจุงูุงุณู ุฃู ุฑูู ุงููุงุชู
- **ุงูุญุงูุฉ**: ูุชุตูุ ูุดุบููุ ุฎุงููุ ุบูุฑ ูุชุตู
- **ุงููุฏููุฉ**: ุชุตููุฉ ุฌุบุฑุงููุฉ
- **ุฎุฑูุทุฉ ุงูุญุฑุงุฑุฉ**: ุฅุธูุงุฑ ุงููุดุงุท ูู ุขุฎุฑ ุณุงุนุฉ

##### ุงูุชูุจููุงุช ุงูุชุดุบูููุฉ
- **ูุจุงุชู ุบูุฑ ูุชุตููู**: ูุฑุงูุจุฉ ููุฏุงู ุงูุงุชุตุงู
- **ุฎุฑู SLA**: ุทูุจุงุช ูุชุฃุฎุฑุฉ ูู ุงูุชูุตูู
- **ูุซุงูุฉ ุทูุจุงุช ุนุงููุฉ**: ุนูุฏูุง ุชููู >70% ูู ุงูุณุงุฆููู ูุดุบูููู

##### ุงูุฎุฑูุทุฉ ุงูุชูุงุนููุฉ
- **ุฎุฑูุทุฉ OpenStreetMap**: ุนุฑุถ ููุงูุน ุงูุณุงุฆููู
- **ุนูุงูุงุช ููููุฉ**: ุญุณุจ ุญุงูุฉ ุงูุณุงุฆู
- **ููุงูุฐ ูุนูููุงุช**: ุชูุงุตูู ุงูุณุงุฆู ูุงูุทูุจ ุงูุญุงูู
- **ุนูุงุตุฑ ุชุญูู**: ุฃุฒุฑุงุฑ ููุฅุฌุฑุงุกุงุช (ูููุ ุฅุดุนุงุฑุ ุฅุฑุณุงู ุชูุจูู)

##### ุงูุฅุฌุฑุงุกุงุช ุงูุชุดุบูููุฉ
- **ููู ูุคูุช**: ุชุนุทูู ุงูุณุงุฆู ูุคูุชุงู
- **ุฅุฑุณุงู ุฅุดุงุฑุฉ**: Ping ููุชุฃูุฏ ูู ุงูุงุณุชุฌุงุจุฉ
- **ุฅุฑุณุงู ุชูุจูู**: ุฅุดุนุงุฑ ููุณุงุฆู

## ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช (APIs)

### 1. ูุงุฌูุงุช ููุญุฉ ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ

#### `/admin/dashboard/summary`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ููุฎุต ุดุงูู ููุฃุฏุงุก
**ุงููุนุทูุงุช**:
- `from`: ุชุงุฑูุฎ ุงูุจุฏุงูุฉ (YYYY-MM-DD)
- `to`: ุชุงุฑูุฎ ุงูููุงูุฉ (YYYY-MM-DD)
- `tz`: ุงูููุทูุฉ ุงูุฒูููุฉ

**ุงูุงุณุชุฌุงุจุฉ**:
```typescript
{
  range: { from: string, to: string },
  users: number,
  drivers: number,
  stores: number,
  orders: number,
  gmv: number,
  revenue: number,
  deliveryFees: number,
  cancelRate: number,
  deliveryTime: {
    avgMin: number | null,
    p90Min: number | null
  },
  byStatus: Array<{status: string, count: number}>
}
```

#### `/admin/dashboard/timeseries`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุงูุจูุงูุงุช ุงูุฒูููุฉ ููุฑุณูู ุงูุจูุงููุฉ
**ุงููุนุทูุงุช**:
- `from`, `to`, `tz`: ููุณ ุงููุนุทูุงุช ุงูุณุงุจูุฉ
- `metric`: orders | gmv | revenue
- `interval`: day | hour

#### `/admin/dashboard/top`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุฃูุถู ุงูุนูุงุตุฑ ุฃุฏุงุกู
**ุงููุนุทูุงุช**:
- `from`, `to`, `tz`: ููุณ ุงููุนุทูุงุช
- `by`: stores | cities | categories
- `limit`: ุนุฏุฏ ุงูุนูุงุตุฑ (ุงูุชุฑุงุถู 10)

#### `/admin/dashboard/alerts`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุงูุชูุจููุงุช ุงูุนุงุฌูุฉ
**ุงูุงุณุชุฌุงุจุฉ**:
```typescript
{
  todayFrom: string,
  awaitingProcurement: number,
  awaitingAssign: number,
  overdueDeliveries: number
}
```

### 2. ูุงุฌูุงุช ุงูุชุณููู

#### `/marketing/roas`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุจูุงูุงุช ุนุงุฆุฏ ุงูุฅููุงู ุงูุฅุนูุงูู
**ุงููุนุทูุงุช**:
- `from`, `to`: ูุทุงู ุงูุชุงุฑูุฎ
- `groupBy`: source | campaign | none

### 3. ูุงุฌูุงุช ุงูุณุงุฆููู

#### `/drivers/health`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุญุงูุฉ ุตุญุฉ ูุธุงู ุงูุณุงุฆููู

#### `/admin/drivers/docs/expiring`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุงููุซุงุฆู ุงูููุจูุฉ ุนูู ุงูุงูุชูุงุก
**ุงููุนุทูุงุช**:
- `days`: ุนุฏุฏ ุงูุฃูุงู (ุงูุชุฑุงุถู 30)

### 4. ูุงุฌูุงุช ุงูุชูุงุฑูุฑ

#### `/admin/reports/system-overview`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุธุงู

#### `/admin/reports/financial-summary`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุงูููุฎุต ุงููุงูู

#### `/admin/reports/order-analytics`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุชุญูููุงุช ุงูุทูุจุงุช

#### `/admin/reports/user-analytics`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุชุญูููุงุช ุงููุณุชุฎุฏููู

#### `/admin/reports/vendor-analytics`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุชุญูููุงุช ุงูุชุฌุงุฑ

#### `/admin/reports/driver-analytics`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุชุญูููุงุช ุงูุณุงุฆููู

#### `/admin/reports/realtime-metrics`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุงูููุงููุณ ุงููุญุธูุฉ

### 5. ูุงุฌูุงุช ุนูููุงุช ุงูุณุงุฆููู

#### `/admin/ops/drivers/realtime`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุจูุงูุงุช ุงูุณุงุฆููู ุงูููุฑูุฉ
**ุงููุนุทูุงุช**:
- `city`: ุชุตููุฉ ุญุณุจ ุงููุฏููุฉ (ุงุฎุชูุงุฑู)

**ุงูุงุณุชุฌุงุจุฉ**:
```typescript
{
  drivers: Array<{
    id: string,
    name: string,
    phone?: string,
    status: "online" | "busy" | "idle" | "offline",
    lat: number,
    lng: number,
    speed?: number,
    lastSeen: string,
    orderId?: string | null,
    city?: string,
    slaBreached?: boolean
  }>
}
```

#### `/admin/ops/heatmap`
**ุงูุทุฑููุฉ**: GET
**ุงููุตู**: ุฌูุจ ุจูุงูุงุช ุฎุฑูุทุฉ ุงูุญุฑุงุฑุฉ
**ุงููุนุทูุงุช**:
- `from`, `to`: ูุทุงู ุฒููู ููุจูุงูุงุช

#### `/admin/ops/drivers/{id}/actions`
**ุงูุทุฑููุฉ**: POST
**ุงููุตู**: ุชูููุฐ ุฅุฌุฑุงุก ุนูู ุณุงุฆู ูุญุฏุฏ
**ุงููุนุทูุงุช**:
```typescript
{
  action: "lock" | "ping" | "notify",
  reason?: string
}
```

## ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูููุงุฐุฌ

### ุงูููุงุฐุฌ ุงูุฑุฆูุณูุฉ

#### ูููุฐุฌ ุงูุทูุจุงุช (Order)
```typescript
{
  _id: ObjectId,
  user: ObjectId, // ูุฑุฌุน ูููุณุชุฎุฏู
  store: ObjectId, // ูุฑุฌุน ูููุชุฌุฑ
  driver?: ObjectId, // ูุฑุฌุน ููุณุงุฆู (ุงุฎุชูุงุฑู)
  status: "placed" | "awaiting_procurement" | "procured" | "out_for_delivery" | "delivered" | "cancelled",
  items: Array<{
    product: ObjectId,
    quantity: number,
    price: number
  }>,
  price: number, // ุณุนุฑ ุงูููุชุฌุงุช
  deliveryFee: number, // ุฑุณูู ุงูุชูุตูู
  platformShare: number, // ุนูููุฉ ุงูููุตุฉ
  address: {
    city: string,
    district: string,
    street: string,
    coordinates: [number, number]
  },
  createdAt: Date,
  updatedAt: Date,
  deliveredAt?: Date,
  rating?: {
    company: number,
    order: number,
    driver: number
  }
}
```

#### ูููุฐุฌ ุงูุณุงุฆููู (Driver)
```typescript
{
  _id: ObjectId,
  user: ObjectId, // ูุฑุฌุน ูููุณุชุฎุฏู
  status: "online" | "busy" | "idle" | "offline",
  currentLocation: {
    lat: number,
    lng: number,
    lastUpdated: Date
  },
  documents: Array<{
    type: "license" | "vehicle" | "insurance",
    number: string,
    expiryDate: Date,
    status: "valid" | "expiring" | "expired"
  }>,
  ratings: Array<{
    order: ObjectId,
    rating: number,
    comment?: string
  }>,
  totalDeliveries: number,
  createdAt: Date,
  updatedAt: Date
}
```

#### ูููุฐุฌ ุงููุชุงุฌุฑ (DeliveryStore)
```typescript
{
  _id: ObjectId,
  name: string,
  description?: string,
  owner: ObjectId,
  address: {
    city: string,
    district: string,
    street: string,
    coordinates: [number, number]
  },
  category: string,
  rating: number,
  totalOrders: number,
  isActive: boolean,
  createdAt: Date,
  updatedAt: Date
}
```

#### ูููุฐุฌ ููุงุท ุงูุฏุนู (SupportTicket)
```typescript
{
  _id: ObjectId,
  number: string, // ุฑูู ุงูุชุฐูุฑุฉ
  subject: string,
  description: string,
  status: "new" | "open" | "pending" | "resolved" | "closed",
  priority: "low" | "medium" | "high" | "urgent",
  assignee?: string,
  group: string,
  channel: "web" | "mobile" | "phone" | "email",
  source: "customer" | "driver" | "vendor" | "internal",
  requester: {
    userId: string,
    phone?: string,
    email?: string
  },
  links: {
    orderId?: ObjectId,
    store?: ObjectId,
    driver?: ObjectId
  },
  tags: string[],
  firstResponseAt?: Date,
  resolvedAt?: Date,
  createdAt: Date,
  updatedAt: Date
}
```

## ุงูุฃูุงู ูุงูุญูุงูุฉ

### ุขููุงุช ุงููุตุงุฏูุฉ
- **JWT Tokens**: ูููุตุงุฏูุฉ ุนุฏููุฉ ุงูุญุงูุฉ
- **Refresh Tokens**: ูุชุฌุฏูุฏ ุงูุฌูุณุงุช
- **Password Hashing**: bcrypt ูุชุดููุฑ ูููุงุช ุงููุฑูุฑ
- **Rate Limiting**: ุญูุงูุฉ ูู ุงููุฌูุงุช ุงูููุฑุทุฉ

### ุขููุงุช ุงูุชุฑุฎูุต
- **Role-Based Access Control (RBAC)**: ูุธุงู ุฃุฐููุงุช ูุจูู ุนูู ุงูุฃุฏูุงุฑ
- **Middleware**: ูุญุต ุงูุฃุฐููุงุช ูู ูู ุทูุจ
- **API Keys**: ููุงุชูุญ ุขููุฉ ูููุตูู ุงูุฎุงุฑุฌู

### ูุฑุงูุจุฉ ุงูุฃูุงู
- **Sentry Integration**: ูุฑุงูุจุฉ ุงูุฃุฎุทุงุก ูุงูุฃุฏุงุก
- **Audit Logging**: ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงูุญุณุงุณุฉ
- **Data Validation**: ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- **Input Sanitization**: ุชูุธูู ุงููุฏุฎูุงุช

## ูุฑุงูุจุฉ ุงูุฃุฏุงุก ูุงูุฃุฎุทุงุก

### Sentry Configuration
```typescript
// bthwani-web/src/lib/sentry.ts
import { init, captureException, captureMessage } from '@sentry/react';
import { Replay } from '@sentry/replay';

init({
  dsn: process.env.REACT_APP_SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 1.0,
  replaysOnErrorSampleRate: 1.0,
  replaysSessionSampleRate: 0.1,
  integrations: [new Replay()],
});
```

### ูุฑุงูุจุฉ ุงูุฃุฏุงุก
- **Performance Monitoring**: ูุฑุงูุจุฉ ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ
- **Error Tracking**: ุชุชุจุน ูุชุตููู ุงูุฃุฎุทุงุก
- **User Session Replay**: ุฅุนุงุฏุฉ ุชุดุบูู ุฌูุณุงุช ุงููุณุชุฎุฏููู
- **Custom Metrics**: ููุงููุณ ูุฎุตุตุฉ ููุฃุนูุงู

## ูููู ุงููุดุฑูุน

```
Bthwani Platform/
โโโ admin-dashboard/          # ููุญุฉ ุฅุฏุงุฑุฉ ุงููุดุฑููู
โ   โโโ src/
โ   โ   โโโ components/       # ุงูููููุงุช ุงููุดุชุฑูุฉ
โ   โ   โโโ pages/           # ุตูุญุงุช ููุญุฉ ุงูุชุญูู
โ   โ   โ   โโโ admin/       # ููุญุฉ ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ
โ   โ   โ   โโโ marketing/   # ููุญุฉ ุงูุชุณููู
โ   โ   โ   โโโ drivers/     # ููุญุฉ ุงูุณุงุฆููู
โ   โ   โ   โโโ support/     # ูุธุงู ุงูุฏุนู ุงูููู
โ   โ   โ   โโโ ops/         # ููุญุฉ ุงูุนูููุงุช
โ   โ   โโโ utils/           # ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ
โ   โ   โโโ api/             # ุทุจูุฉ ุงูู API
โ   โโโ package.json
โ   โโโ Dockerfile
โโโ Backend/                 # ุงูุฎุงุฏู ุงูุฎููู
โ   โโโ src/
โ   โ   โโโ controllers/     # ููุทู ูุนุงูุฌุฉ ุงูุทูุจุงุช
โ   โ   โโโ models/          # ููุงุฐุฌ ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ   โ   โโโ routes/          # ุชุนุฑูู ุงููุณุงุฑุงุช
โ   โ   โโโ middleware/      # ุงููุณุงุฆุท ุงูุจุฑูุฌูุฉ
โ   โ   โโโ utils/           # ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ
โ   โ   โโโ services/        # ุงูุฎุฏูุงุช ุงูุฎุงุฑุฌูุฉ
โ   โโโ package.json
โ   โโโ Dockerfile
โโโ bthwani-web/            # ุงูุชุทุจูู ุงูุฑุฆูุณู ููุนููุงุก
โโโ field-marketers/        # ุชุทุจูู ุงููุณูููู ุงูููุฏุงูููู
โโโ rider-app/             # ุชุทุจูู ุงูุณุงุฆููู
โโโ vendor-app/            # ุชุทุจูู ุงูุชุฌุงุฑ
โโโ docs/                  # ุงูุชูุซูู
    โโโ api/               # ุชูุซูู API
    โโโ deployment/        # ุฏููู ุงููุดุฑ
    โโโ security/          # ุฏููู ุงูุฃูุงู
    โโโ monitoring/        # ุฏููู ุงููุฑุงูุจุฉ
```

## ุงูุงุณุชูุชุงุฌุงุช ูุงูุชูุตูุงุช

### ููุงุท ุงูููุฉ
1. **ุชุตููู ุดุงูู**: ูุบุทู ุฌููุน ุฌูุงูุจ ุงูุนูููุงุช ุงูุชุดุบูููุฉ
2. **ุฃุฏุงุก ุนุงูู**: ุงุณุชุฎุฏุงู ุชูููุงุช ุญุฏูุซุฉ ููุนุงูุฉ
3. **ูุฑููุฉ ุนุงููุฉ**: ุณูููุฉ ุงูุชุฎุตูุต ูุงูุชุทููุฑ
4. **ุฃูุงู ูุชูุฏู**: ุญูุงูุฉ ูุชุนุฏุฏุฉ ุงูุทุจูุงุช
5. **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ**: ูุงุฌูุงุช ุจุฏูููุฉ ูุณููุฉ ุงูุงุณุชุฎุฏุงู

### ูุฌุงูุงุช ุงูุชุทููุฑ ุงูููุชุฑุญุฉ
1. **ุงูุชูุณุน ุงูุฌุบุฑุงูู**: ุฏุนู ุงููุฒูุฏ ูู ุงูุฏูู ูุงูุนููุงุช
2. **ุงูุชูุงููุงุช ุงูุฅุถุงููุฉ**: ุฑุจุท ูุน ุฎุฏูุงุช ุฎุงุฑุฌูุฉ ุฃูุซุฑ
3. **ุงูุฐูุงุก ุงูุงุตุทูุงุนู**: ุงุณุชุฎุฏุงู ML ููุชูุจุค ูุงูุชุญุณูู
4. **ุชุทุจูู ูุญููู**: ุชุทููุฑ ุชุทุจููุงุช native ููููุงุชู
5. **ุงุฎุชุจุงุฑุงุช ุขููุฉ**: ุฒูุงุฏุฉ ุชุบุทูุฉ ุงูุงุฎุชุจุงุฑุงุช

ูุฐุง ุงููุธุงู ููุซู ุญูุงู ุดุงููุงู ููุชุทูุฑุงู ูุฅุฏุงุฑุฉ ููุตุงุช ุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ ูุงูุชูุตููุ ููููุฑ ุฃุณุงุณุงู ูููุงู ููููู ูุงูุชูุณุน ุงููุณุชูุจูู.
