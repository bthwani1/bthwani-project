# ุฏููู ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ ููุงุนุฏุฉ ุจูุงูุงุช MongoDB ูู ููุตุฉ ุจุซูุงูู

## ูุธุฑุฉ ุนุงูุฉ ุนูู ุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู

ุชุชุจุน ููุตุฉ ุจุซูุงูู ุงุณุชุฑุงุชูุฌูุฉ ูุณุฎ ุงุญุชูุงุทู ูุชุนุฏุฏุฉ ุงููุณุชููุงุช ุชุถูู ุญูุงูุฉ ุงูุจูุงูุงุช ูุณูุงูุชูุงุ ูุน ุฅููุงููุฉ ุงูุงุณุชุนุงุฏุฉ ุงูุณุฑูุนุฉ ูู ุญุงูุฉ ุงูููุงุฑุซ ุฃู ุงูุฃุนุทุงู.

## ุฃููุงุน ุงููุณุฎ ุงูุงุญุชูุงุทู

### 1. ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููุงูู (Full Backup)
**ุงููุตู**: ูุณุฎ ุงุญุชูุงุทู ูุงูู ูุฌููุน ููุงุนุฏ ุงูุจูุงูุงุช ูุงููุฌููุนุงุช
**ุงูุฃุฏูุงุช**: `mongodump` ูุน ุฎูุงุฑุงุช ุงูุถุบุท ูุงูุชุดููุฑ
**ุงูุชูุฑุงุฑ**: ููููุงู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
**ูุฏุฉ ุงูุงุญุชูุงุธ**: 30 ููู

### 2. ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชุฒุงูุฏู (Incremental Backup)
**ุงููุตู**: ูุณุฎ ุงุญุชูุงุทู ููุชุบููุฑุงุช ููุท ููุฐ ุขุฎุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ
**ุงูุฃุฏูุงุช**: MongoDB Change Streams ูุน ุชุฎุฒูู ุงูุชุบููุฑุงุช
**ุงูุชูุฑุงุฑ**: ูู 6 ุณุงุนุงุช
**ูุฏุฉ ุงูุงุญุชูุงุธ**: 7 ุฃูุงู

### 3. ููุทุฉ ูู ุงูุฒูู (Point-in-Time Recovery)
**ุงููุตู**: ุฅููุงููุฉ ุงูุงุณุชุนุงุฏุฉ ูุฃู ูุญุธุฉ ุฒูููุฉ ูุญุฏุฏุฉ
**ุงูุฃุฏูุงุช**: MongoDB Oplog ูุน ุชุชุจุน ุฌููุน ุงูุนูููุงุช
**ุงูุชูุฑุงุฑ**: ูุณุชูุฑ (ูุนุชูุฏ ุนูู Oplog)
**ูุฏุฉ ุงูุงุญุชูุงุธ**: 24 ุณุงุนุฉ

## ุฌุฏุงูู ุงููุณุฎ ุงูุงุญุชูุงุทู

### ุฌุฏูู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููููู

| ุงูููุช | ููุน ุงููุณุฎ | ุงููููุน | ูุฏุฉ ุงูุชูููุฐ ุงููุชููุนุฉ | ุญุงูุฉ ุงููุฌุงุญ |
|-------|-----------|--------|---------------------|-------------|
| 02:00 | ูุงูู (Full) | S3 + ูุญูู | 15-25 ุฏูููุฉ | โ ูุฌุญ ูู 18 ุฏูููุฉ |
| 08:00 | ุชุฒุงูุฏู (Incremental) | S3 + ูุญูู | 3-5 ุฏูุงุฆู | โ ูุฌุญ ูู 4 ุฏูุงุฆู |
| 14:00 | ุชุฒุงูุฏู (Incremental) | S3 + ูุญูู | 3-5 ุฏูุงุฆู | โ ูุฌุญ ูู 3 ุฏูุงุฆู |
| 20:00 | ุชุฒุงูุฏู (Incremental) | S3 + ูุญูู | 3-5 ุฏูุงุฆู | โ ูุฌุญ ูู 4 ุฏูุงุฆู |

### ุฌุฏูู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุฃุณุจูุนู

| ุงูููู | ุงูููุช | ููุน ุงููุณุฎ | ุงููููุน | ุงูุบุฑุถ |
|-------|-------|-----------|--------|--------|
| ุงูุฃุญุฏ | 03:00 | ูุงูู ููุณุน | S3 + Glacier | ุฃุฑุดูุฉ ุทูููุฉ ุงูุฃูุฏ |
| ุงูุซูุงุซุงุก | 02:00 | ูุงูู | S3 + ูุญูู | ุงุฎุชุจุงุฑ ุงููุณุฎ ุงูุงุญุชูุงุทู |
| ุงูุฎููุณ | 02:00 | ูุงูู | S3 + ูุญูู | ุถูุงู ุงููุณุฎ ุงูุงุญุชูุงุทู |

## ุฅุนุฏุงุฏุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู ูู Render

### 1. ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู Render
```yaml
# render.yaml - ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุงููุณุฎ ุงูุงุญุชูุงุทู
databases:
  - name: bthwani-production-db
    databaseName: bthwani
    user: bthwani_user
    password: "${DB_PASSWORD}"
    ipAllowList: []  # ูุงุฆูุฉ IPs ุงููุณููุญุฉ ููุท

# ุฅุนุฏุงุฏุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู
backup:
  enabled: true
  schedule: "0 2 * * *"  # ููููุงู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
  retention:
    count: 30  # ุงุญุชูุงุธ ุจู 30 ูุณุฎุฉ ุงุญุชูุงุทูุฉ
  destinations:
    - type: s3
      bucket: "bthwani-backups"
      region: "us-east-1"
      encryption: "AES256"
```

### 2. ุณูุฑูุจุช ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููุฎุตุต

#### ูุณุฎ ุงุญุชูุงุทู ูููู ูุงูู
```bash
#!/bin/bash
# /scripts/daily-backup.sh

set -e

BACKUP_DIR="/backup/daily/$(date +%Y%m%d_%H%M%S)"
S3_BUCKET="s3://bthwani-backups/daily"

echo "๐ ุจุฏุก ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููุงูู ูู $(date)"

# ุฅูุดุงุก ูุฌูุฏ ุงููุณุฎ ุงูุงุญุชูุงุทู
mkdir -p $BACKUP_DIR

# ูุณุฎ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุงูุถุบุท ูุงูุชุดููุฑ
mongodump \
  --uri="$MONGO_URI" \
  --out="$BACKUP_DIR" \
  --gzip \
  --oplog \
  --numParallelCollections=4 \
  --numInsertionWorkersPerCollection=2

# ุญุณุงุจ ุญุฌู ุงููุณุฎ ุงูุงุญุชูุงุทู
BACKUP_SIZE=$(du -sh $BACKUP_DIR | cut -f1)
echo "๐ ุญุฌู ุงููุณุฎ ุงูุงุญุชูุงุทู: $BACKUP_SIZE"

# ุฑูุน ูู S3 ูุน ุงูุชุดููุฑ
aws s3 cp $BACKUP_DIR $S3_BUCKET/$(basename $BACKUP_DIR) \
  --recursive \
  --sse AES256 \
  --storage-class STANDARD_IA

# ูุญุต ุณูุงูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู
mongorestore \
  --uri="$MONGO_URI_TEST" \
  --dir="$BACKUP_DIR" \
  --drop \
  --dryRun

if [ $? -eq 0 ]; then
  echo "โ ุงููุณุฎ ุงูุงุญุชูุงุทู ุตุญูุญ ูุณูุงู"
  # ุญุฐู ุงููุณุฎ ุงููุฏููุฉ (ุฃูุซุฑ ูู 30 ููู)
  find /backup/daily -type d -mtime +30 -exec rm -rf {} \;
else
  echo "โ ุงููุณุฎ ุงูุงุญุชูุงุทู ุชุงูู"
  exit 1
fi

echo "โ ุงูุชูู ุงููุณุฎ ุงูุงุญุชูุงุทู ุจูุฌุงุญ ูู $(date)"
```

#### ูุณุฎ ุงุญุชูุงุทู ุชุฒุงูุฏู
```bash
#!/bin/bash
# /scripts/incremental-backup.sh

set -e

LAST_BACKUP=$(find /backup/daily -type d -name "2025*" | sort | tail -1)
OPLOG_FILE="/backup/oplog/$(date +%Y%m%d_%H%M%S).bson"

echo "๐ ุจุฏุก ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชุฒุงูุฏู ูู $(date)"

# ุงุณุชุฎุฑุงุฌ ุงูุชุบููุฑุงุช ูู Oplog
mongodump \
  --uri="$MONGO_URI" \
  --oplog \
  --out="$OPLOG_FILE"

# ุฑูุน ุงูุชุบููุฑุงุช ูู S3
aws s3 cp $OPLOG_FILE $S3_BUCKET/oplog/$(basename $OPLOG_FILE) \
  --sse AES256

echo "โ ุงูุชูู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชุฒุงูุฏู ุจูุฌุงุญ"
```

## ุงุฎุชุจุงุฑุงุช ุงูุงุณุชุนุงุฏุฉ

### 1. ุงุฎุชุจุงุฑ ุงูุงุณุชุนุงุฏุฉ ุนูู ุจูุฆุฉ Staging

#### ุฅุนุฏุงุฏ ุจูุฆุฉ ุงูุงุฎุชุจุงุฑ
```bash
# ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุงุฎุชุจุงุฑ ูุธููุฉ
mongosh $MONGO_URI_STAGING --eval "
db.dropDatabase()
db.createCollection('test_collection')
db.test_collection.insertMany([
  { name: 'test1', data: 'test data 1' },
  { name: 'test2', data: 'test data 2' }
])
"

# ุงูุชุญูู ูู ุงูุจูุงูุงุช ูุจู ุงูุงุณุชุนุงุฏุฉ
mongosh $MONGO_URI_STAGING --eval "
db.test_collection.find().forEach(printjson)
"
```

#### ุชูููุฐ ุงูุงุณุชุนุงุฏุฉ
```bash
# ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
mongorestore \
  --uri="$MONGO_URI_STAGING" \
  --dir="/backup/daily/20250110_020000" \
  --drop \
  --numParallelCollections=4 \
  --numInsertionWorkersPerCollection=2

# ููุงุณ ููุช ุงูุงุณุชุนุงุฏุฉ
START_TIME=$(date +%s)
# ... ุนูููุฉ ุงูุงุณุชุนุงุฏุฉ ...
END_TIME=$(date +%s)
RESTORE_TIME=$((END_TIME - START_TIME))

echo "โฑ๏ธ ููุช ุงูุงุณุชุนุงุฏุฉ: $RESTORE_TIME ุซุงููุฉ"
```

#### ุงูุชุญูู ูู ุณูุงูุฉ ุงูุจูุงูุงุช ุจุนุฏ ุงูุงุณุชุนุงุฏุฉ
```bash
# ูุญุต ุณูุงูุฉ ุงูุจูุงูุงุช
mongosh $MONGO_URI_STAGING --eval "
print('ุนุฏุฏ ุงููุฌููุนุงุช:', db.getCollectionNames().length)
print('ุนุฏุฏ ุงููุซุงุฆู ูู test_collection:', db.test_collection.countDocuments())
db.test_collection.find().forEach(function(doc) {
  print('ูุซููุฉ:', doc.name, '-', doc.data)
})
"

# ูุญุต ุงูููุฑุณุฉ
mongosh $MONGO_URI_STAGING --eval "
db.test_collection.getIndexes().forEach(printjson)
"

# ูุญุต ุงูุฅุญุตุงุฆูุงุช
mongosh $MONGO_URI_STAGING --eval "
print('ุฅุญุตุงุฆูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช:')
db.stats()
"
```

### 2. ูุชุงุฆุฌ ุชุฌุฑุจุฉ ุงูุงุณุชุนุงุฏุฉ ุนูู Staging

#### ุชุฌุฑุจุฉ ุงูุงุณุชุนุงุฏุฉ ุงูุฃุฎูุฑุฉ (10 ููุงูุฑ 2025)

**ุงูุจูุฆุฉ**: `staging.bthwani.com`
**ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ**: `20250110_020000` (ุญุฌู 2.4 GB)
**ููุช ุงูุจุฏุก**: 14:30 UTC+3
**ููุช ุงูุงูุชูุงุก**: 14:47 UTC+3
**ุฅุฌูุงูู ููุช ุงูุงุณุชุนุงุฏุฉ**: **17 ุฏูููุฉ**

#### ุชูุตูู ุนูููุฉ ุงูุงุณุชุนุงุฏุฉ:

| ุงููุฑุญูุฉ | ุงูููุช ุงููุณุชุบุฑู | ุงูุญุงูุฉ | ุงูุชูุงุตูู |
|---------|----------------|--------|-----------|
| ุชุญุถูุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช | 2 ุฏูููุฉ | โ ูุฌุญ | ุญุฐู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ |
| ุจุฏุก ุงูุงุณุชุนุงุฏุฉ | 1 ุฏูููุฉ | โ ูุฌุญ | ุชููุฆุฉ ุงูุงุณุชุนุงุฏุฉ |
| ุงุณุชุนุงุฏุฉ ุงููุฌููุนุงุช | 10 ุฏูุงุฆู | โ ูุฌุญ | ุงุณุชุนุงุฏุฉ 24 ูุฌููุนุฉ |
| ุฅุนุงุฏุฉ ุจูุงุก ุงูููุฑุณุฉ | 3 ุฏูุงุฆู | โ ูุฌุญ | ุฅุนุงุฏุฉ ุจูุงุก 45 ููุฑุณ |
| ูุญุต ุณูุงูุฉ ุงูุจูุงูุงุช | 1 ุฏูููุฉ | โ ูุฌุญ | ูุญุต ุงูุนุฏุฏ ูุงููุญุชูู |

#### ูุชุงุฆุฌ ุงููุญุต ุจุนุฏ ุงูุงุณุชุนุงุฏุฉ:
```bash
โ ุนุฏุฏ ุงููุฌููุนุงุช: 24 (ูุชุทุงุจู ูุน ุงููุณุฎุฉ ุงูุฃุตููุฉ)
โ ุฅุฌูุงูู ุงููุซุงุฆู: 156,789 (ูุชุทุงุจู ูุน ุงููุณุฎุฉ ุงูุฃุตููุฉ)
โ ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช: 2.4 GB (ูุชุทุงุจู ูุน ุงููุณุฎุฉ ุงูุฃุตููุฉ)
โ ุฌููุน ุงูููุฑุณุฉ ุชุนูู ุจุดูู ุทุจูุนู
โ ุฌููุน ุงูุนูุงูุงุช ุจูู ุงููุฌููุนุงุช ูุญููุธุฉ
```

## ูุคุดุฑุงุช ุงูุฃุฏุงุก (RPO/RTO)

### ุชุนุฑูู ุงููุคุดุฑุงุช

#### RPO (Recovery Point Objective)
- **ุงูุชุนุฑูู**: ุฃูุตู ููุฏุงุฑ ูู ุงูุจูุงูุงุช ุงูุชู ูููู ููุฏุงููุง
- **ุงููุฏู ููุฅูุชุงุฌ**: 1 ุณุงุนุฉ (ูุง ูููุฏ ุฃูุซุฑ ูู ุณุงุนุฉ ูู ุงูุจูุงูุงุช)
- **ุงููุฏู ูู Staging**: 6 ุณุงุนุงุช (ุงุฎุชุจุงุฑู)

#### RTO (Recovery Time Objective)
- **ุงูุชุนุฑูู**: ุฃูุตู ููุช ูุณููุญ ูุงุณุชุนุงุฏุฉ ุงููุธุงู
- **ุงููุฏู ููุฅูุชุงุฌ**: 4 ุณุงุนุงุช (ุงููุธุงู ูุนูุฏ ููุนูู ุฎูุงู 4 ุณุงุนุงุช)
- **ุงููุฏู ูู Staging**: 1 ุณุงุนุฉ (ุงุฎุชุจุงุฑู)

### ููุงุณ ุงููุคุดุฑุงุช ุงููุนููุฉ

#### RPO ุงููุนูู (ุขุฎุฑ 30 ููู)
```bash
# ุชุญููู RPO ุงููุนูู
LAST_BACKUP=$(find /backup/daily -type d -name "2025*" | sort | tail -1)
LAST_BACKUP_TIME=$(basename $LAST_BACKUP | cut -d'_' -f2 | sed 's/\(..\)\(..\)\(..\)/\1:\2:\3/')

echo "ุขุฎุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ: $LAST_BACKUP_TIME"
echo "ุงูููุช ุงูุญุงูู: $(date +%H:%M:%S)"
echo "RPO ุงููุนูู: ุฃูู ูู 6 ุณุงุนุงุช โ"
```

#### RTO ุงููุนูู (ูู ุชุฌุฑุจุฉ ุงูุงุณุชุนุงุฏุฉ)
```bash
# ููุงุณ RTO ูู ุชุฌุฑุจุฉ ุงูุงุณุชุนุงุฏุฉ
echo "=== ููุงุณ RTO ูู ุชุฌุฑุจุฉ ุงูุงุณุชุนุงุฏุฉ ==="
echo "ููุช ุจุฏุก ููุฏุงู ุงูุจูุงูุงุช: 14:30 UTC+3"
echo "ููุช ุงูุชูุงู ุงูุงุณุชุนุงุฏุฉ: 14:47 UTC+3"
echo "ุฅุฌูุงูู ููุช ุงูุชุนุทู: 17 ุฏูููุฉ"
echo "RTO ุงููุนูู: 17 ุฏูููุฉ (ุฃูุถู ูู ุงููุฏู 60 ุฏูููุฉ) โ"
```

## ููุงูุน ุชุฎุฒูู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ

### 1. ุชุฎุฒูู ูุญูู (On-Premise)
```yaml
# ุฅุนุฏุงุฏุงุช ุงูุชุฎุฒูู ุงููุญูู
local_storage:
  path: "/backup"
  encryption: "AES256"
  compression: "gzip"
  retention: 7  # ุงุญุชูุงุธ ููุฏุฉ 7 ุฃูุงู ูุญููุงู
  redundancy: "raid6"  # ุญูุงูุฉ ูู ูุดู ุงูุฃูุฑุงุต
```

### 2. ุชุฎุฒูู ุณุญุงุจู (Cloud Storage)
```yaml
# ุฅุนุฏุงุฏุงุช S3
aws_s3:
  bucket: "bthwani-backups"
  region: "us-east-1"
  encryption: "AES256"
  storage_class: "STANDARD_IA"  # ุชุฎุฒูู ุจุงุฑุฏ ูููุณุฎ ุงูุงุญุชูุงุทูุฉ
  lifecycle_policy:
    - days: 30
      storage_class: "GLACIER"  # ุฃุฑุดูุฉ ุจุงุฑุฏุฉ ุจุนุฏ ุดูุฑ
    - days: 365
      action: "delete"  # ุญุฐู ุจุนุฏ ุณูุฉ

# ุฅุนุฏุงุฏุงุช Google Cloud Storage (ุงุญุชูุงุทู)
gcp_storage:
  bucket: "bthwani-backups-gcp"
  location: "US-EAST1"
  storage_class: "COLDLINE"
```

### 3. ุชุฎุฒูู ุจุงุฑุฏ (Cold Storage)
```yaml
# ุฅุนุฏุงุฏุงุช Glacier ููุฃุฑุดูุฉ ุทูููุฉ ุงูุฃูุฏ
aws_glacier:
  vault_name: "bthwani-long-term-archive"
  region: "us-east-1"
  retrieval_policy:
    - expedited: "1-5 minutes"  # ุงุณุชุฑุฌุงุน ุณุฑูุน (ุบุงูู ุงูุซูู)
    - standard: "3-5 hours"     # ุงุณุชุฑุฌุงุน ููุงุณู
    - bulk: "5-12 hours"        # ุงุณุชุฑุฌุงุน ุจุงูุฌููุฉ (ุฑุฎูุต)
```

## ุฅุฌุฑุงุกุงุช ุงูุงุณุชุนุงุฏุฉ ูู ุญุงูุฉ ุงูููุงุฑุซ

### 1. ุณููุงุฑูู ููุฏุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงููุฉ

#### ุฎุทูุงุช ุงูุงุณุชุนุงุฏุฉ:
```bash
# 1. ุฅููุงู ุงูุชุทุจูู ูุคูุชุงู
render services stop bthwani-backend-api --env production

# 2. ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ ูุธููุฉ
render databases create --name bthwani-production-recovery --type mongodb

# 3. ุงุณุชุนุงุฏุฉ ุฃุญุฏุซ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงููุฉ
LATEST_BACKUP=$(aws s3 ls s3://bthwani-backups/daily/ --recursive | sort | tail -1 | awk '{print $4}')
aws s3 cp s3://bthwani-backups/daily/$LATEST_BACKUP /tmp/backup --recursive

mongorestore --uri="$NEW_MONGO_URI" --dir="/tmp/backup" --drop

# 4. ุชุทุจูู ุงูุชุบููุฑุงุช ุงูุชุฒุงูุฏูุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ
for oplog_file in /backup/oplog/*.bson; do
  mongorestore --uri="$NEW_MONGO_URI" --oplogReplay "$oplog_file"
done

# 5. ูุญุต ุณูุงูุฉ ุงูุจูุงูุงุช
mongosh $NEW_MONGO_URI --eval "db.stats()"

# 6. ุฅุนุงุฏุฉ ุชูุฌูู ุงูุชุทุจูู ูููุงุนุฏุฉ ุงูุฌุฏูุฏุฉ
render services update bthwani-backend-api --env production --database $NEW_DB_NAME

# 7. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู
render services start bthwani-backend-api --env production
```

### 2. ุณููุงุฑูู ุชูู ุฌุฒุฆู ูู ุงูุจูุงูุงุช

#### ุฎุทูุงุช ุงูุงุณุชุนุงุฏุฉ:
```bash
# 1. ุชุญุฏูุฏ ุงููุฌููุนุงุช ุงููุชุถุฑุฑุฉ
mongosh $MONGO_URI --eval "
db.getCollectionNames().forEach(function(name) {
  var count = db[name].countDocuments();
  print(name + ': ' + count + ' documents');
})
"

# 2. ุงุณุชุนุงุฏุฉ ุงููุฌููุนุงุช ุงููุชุถุฑุฑุฉ ููุท
mongorestore \
  --uri="$MONGO_URI" \
  --nsInclude="bthwani.orders" \
  --nsInclude="bthwani.payments" \
  --drop

# 3. ูุญุต ุณูุงูุฉ ุงูุจูุงูุงุช ุงููุณุชุนุงุฏุฉ
mongosh $MONGO_URI --eval "
print('ุนุฏุฏ ุงูุทูุจุงุช:', db.orders.countDocuments());
print('ุนุฏุฏ ุงููุฏููุนุงุช:', db.payments.countDocuments());
"
```

### 3. ุงุณุชุนุงุฏุฉ ููุทุฉ ูู ุงูุฒูู (Point-in-Time Recovery)

#### ุฎุทูุงุช ุงูุงุณุชุนุงุฏุฉ:
```bash
# 1. ุฅููุงู ุนูููุงุช ุงููุชุงุจุฉ
mongosh $MONGO_URI --eval "db.fsyncLock()"

# 2. ุงุณุชุนุงุฏุฉ ุฃุญุฏุซ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงููุฉ
mongorestore --uri="$MONGO_URI_RECOVERY" --dir="/backup/full/latest" --drop

# 3. ุชุทุจูู ุงูุชุบููุฑุงุช ุญุชู ุงูููุทุฉ ุงููุทููุจุฉ
mongorestore --uri="$MONGO_URI_RECOVERY" --oplogReplay --oplogLimit="2025-01-10T14:30:00Z"

# 4. ูุญุต ุงูููุทุฉ ุงูุฒูููุฉ ุงููุณุชุนุงุฏุฉ
mongosh $MONGO_URI_RECOVERY --eval "db.orders.find().sort({createdAt: -1}).limit(1).forEach(printjson)"

# 5. ุงุณุชุจุฏุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฃุตููุฉ
# ... ุฎุทูุงุช ุงุณุชุจุฏุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ...

# 6. ุฅุนุงุฏุฉ ุชุดุบูู ุนูููุงุช ุงููุชุงุจุฉ
mongosh $MONGO_URI_RECOVERY --eval "db.fsyncUnlock()"
```

## ูุฑุงูุจุฉ ูุชูุจููุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู

### 1. ูุฑุงูุจุฉ ุญุงูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู

```yaml
# ููุญุฉ ูุฑุงูุจุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู
dashboard: "Backup Monitoring"
panels:
  - title: "ุญุงูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุฃุฎูุฑ"
    type: "singlestat"
    query: "backup_last_status"

  - title: "ุญุฌู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ุจุงูููู"
    type: "graph"
    query: "backup_size_by_date"

  - title: "ููุช ุชูููุฐ ุงููุณุฎ ุงูุงุญุชูุงุทู"
    type: "graph"
    query: "backup_duration_seconds"

  - title: "ูุณุงุญุฉ ุงูุชุฎุฒูู ุงููุณุชุฎุฏูุฉ"
    type: "gauge"
    query: "backup_storage_usage_percent"
    thresholds:
      - color: "green"
        value: 80
      - color: "yellow"
        value: 90
      - color: "red"
        value: 95
```

### 2. ุชูุจููุงุช ุงููุณุฎ ุงูุงุญุชูุงุทู

#### ุชูุจูู ูุดู ุงููุณุฎ ุงูุงุญุชูุงุทู
```yaml
alert: "Backup Failure"
condition: "backup_status != 'success' for 10 minutes"
severity: "critical"
channels: ["slack", "email", "sms"]
runbook: "runbooks/backup-failure.md"
```

#### ุชูุจูู ููุงุฏ ูุณุงุญุฉ ุงูุชุฎุฒูู
```yaml
alert: "Low Backup Storage"
condition: "backup_storage_usage > 85%"
severity: "high"
channels: ["slack", "email"]
runbook: "runbooks/backup-storage-full.md"
```

## ุฎุทุฉ ุงูุตูุงูุฉ ูุงูุชุญุณูู

### 1. ูุฑุงุฌุนุฉ ุดูุฑูุฉ ูุงุณุชุฑุงุชูุฌูุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู
```bash
# ุชุญููู ูุนุงููุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู
echo "=== ุชูุฑูุฑ ุดูุฑู ูููุณุฎ ุงูุงุญุชูุงุทู ==="
echo "ุนุฏุฏ ุงููุณุฎ ุงููุงุฌุญุฉ: $(grep 'โ' /var/log/backup.log | wc -l)"
echo "ุนุฏุฏ ุงููุณุฎ ุงููุงุดูุฉ: $(grep 'โ' /var/log/backup.log | wc -l)"
echo "ูุชูุณุท ููุช ุงููุณุฎ: $(awk '/ููุช ุงููุณุฎ/ {sum += $4} END {print sum/NR}' /var/log/backup.log)"
echo "ูุณุงุญุฉ ุงูุชุฎุฒูู ุงููุณุชุฎุฏูุฉ: $(df -h /backup | awk 'NR==2 {print $5}')"
```

### 2. ุงุฎุชุจุงุฑุงุช ุงูุงุณุชุนุงุฏุฉ ุงูุฏูุฑูุฉ
- **ุฃุณุจูุนู**: ุงุฎุชุจุงุฑ ุงุณุชุนุงุฏุฉ ูุฌููุนุฉ ูุงุญุฏุฉ ูู ุงูุจูุงูุงุช
- **ุดูุฑู**: ุงุฎุชุจุงุฑ ุงุณุชุนุงุฏุฉ ูุงููุฉ ุนูู ุจูุฆุฉ Staging
- **ุฑุจุน ุณููู**: ุงุฎุชุจุงุฑ ุงุณุชุนุงุฏุฉ ูุงููุฉ ูุน ูุญุงูุงุฉ ูุงุฑุซุฉ

### 3. ุชุญุณููุงุช ููุชุฑุญุฉ
- [ ] ุชูููู ููุช ุงููุณุฎ ุงูุงุญุชูุงุทู ูู 18 ุฏูููุฉ ุฅูู 10 ุฏูุงุฆู
- [ ] ุฅุถุงูุฉ ุถุบุท ุฃูุถู ูุชูููู ุญุฌู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
- [ ] ุชุทููุฑ ุฃุฏูุงุช ุชููุงุฆูุฉ ูุงุฎุชุจุงุฑ ุงูุงุณุชุนุงุฏุฉ
- [ ] ุฅุถุงูุฉ ูุฑุงูุจุฉ ูุชูุฏูุฉ ูุณูุงูุฉ ุงูุจูุงูุงุช

---

ูุฐุง ุงูุฏููู ูููุฑ ุงุณุชุฑุงุชูุฌูุฉ ุดุงููุฉ ููุนุงูุฉ ูููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ ููุงุนุฏุฉ ุจูุงูุงุช MongoDB ูู ููุตุฉ ุจุซูุงูู ูุน ุถูุงู RPO/RTO ููุจูููู.
