Requirement ID,Requirement,Artifact,Evidence Path,Owner,Status,Notes
"DP-01","Personal Data Encryption","sanitization.helper.ts","src/common/utils/sanitization.helper.ts:16","Security Team","Implemented","'pinCodeHash',"
"","","sanitization.helper.ts","src/common/utils/sanitization.helper.ts:99","","Implemented","* إزالة حقل متداخل (مثل security.pinCodeHash)"
"","","user.entity.ts","src/modules/auth/entities/user.entity.ts:50","","Implemented","pinCodeHash?: string;"
"","","driver.service.ts","src/modules/driver/driver.service.ts:8","","Implemented","import * as bcrypt from 'bcrypt';"
"","","driver.service.ts","src/modules/driver/driver.service.ts:40","","Implemented","const hashedPassword = await bcrypt.hash(createDriverDto.password, 10);"
"","","... and 19 more","","","Implemented",""
"DP-02","Data Minimization","pagination.dto.ts","src/common/dto/pagination.dto.ts:7","Development Team","Implemented","@IsOptional()"
"","","pagination.dto.ts","src/common/dto/pagination.dto.ts:14","","Implemented","@IsOptional()"
"","","pagination.dto.ts","src/common/dto/pagination.dto.ts:24","","Implemented","@IsOptional()"
"","","pagination.dto.ts","src/common/dto/pagination.dto.ts:29","","Implemented","@IsOptional()"
"","","location-update.dto.ts","src/gateways/dto/location-update.dto.ts:14","","Implemented","@IsOptional()"
"","","... and 292 more","","","Implemented",""
"DP-03","Data Retention Policy","app.module.ts","src/app.module.ts:6","Data Team","Implemented","import { ThrottlerModule, ThrottlerGuard } from '@nestjs/throttler';"
"","","app.module.ts","src/app.module.ts:75","","Implemented","ttl: parseInt(process.env.CACHE_TTL || '600', 10),"
"","","app.module.ts","src/app.module.ts:80","","Implemented","ThrottlerModule.forRoot(["
"","","app.module.ts","src/app.module.ts:83","","Implemented","ttl: 60000, // 60 ثانية"
"","","app.module.ts","src/app.module.ts:88","","Implemented","ttl: 60000, // 60 ثانية"
"","","... and 221 more","","","Implemented",""
"CM-01","User Consent Tracking","consent.guard.ts","src/common/guards/consent.guard.ts:3","Legal Team","Implemented","import { ConsentService } from '../../modules/auth/services/consent.service';"
"","","consent.guard.ts","src/common/guards/consent.guard.ts:4","","Implemented","import { ConsentType } from '../../modules/auth/dto/consent.dto';"
"","","consent.guard.ts","src/common/guards/consent.guard.ts:7","","Implemented","export const REQUIRED_CONSENTS_KEY = 'requiredConsents';"
"","","consent.guard.ts","src/common/guards/consent.guard.ts:8","","Implemented","export const RequireConsents = (...consents: ConsentType[]) =>"
"","","consent.guard.ts","src/common/guards/consent.guard.ts:9","","Implemented","SetMetadata(REQUIRED_CONSENTS_KEY, consents);"
"","","... and 315 more","","","Implemented",""
"CM-02","Opt-out Mechanisms","admin.controller.ts","src/modules/admin/admin.controller.ts:142","Product Team","Implemented","// ==================== Withdrawals Management ===================="
"","","admin.controller.ts","src/modules/admin/admin.controller.ts:144","","Implemented","@Get('withdrawals')"
"","","admin.controller.ts","src/modules/admin/admin.controller.ts:146","","Implemented","async getWithdrawals("
"","","admin.controller.ts","src/modules/admin/admin.controller.ts:152","","Implemented","return this.adminService.getWithdrawals(status, userModel, page, limit);"
"","","admin.controller.ts","src/modules/admin/admin.controller.ts:155","","Implemented","@Get('withdrawals/pending')"
"","","... and 91 more","","","Implemented",""
"DSR-01","Right to Access","app.module.ts","src/app.module.ts:13","Development Team","Implemented","import { MetricsInterceptor } from './common/interceptors/metrics.interceptor';"
"","","app.module.ts","src/app.module.ts:30","","Implemented","import { MerchantModule } from './modules/merchant/merchant.module';"
"","","app.module.ts","src/app.module.ts:38","","Implemented","import { MetricsModule } from './modules/metrics/metrics.module';"
"","","metrics.interceptor.ts","src/common/interceptors/metrics.interceptor.ts:9","","Implemented","import { MetricsService } from '../services/metrics.service';"
"","","admin.controller.ts","src/modules/admin/admin.controller.ts:618","","Implemented","@Get('quality/metrics')"
"","","... and 34 more","","","Implemented",""
"DSR-02","Right to Erasure","notification.gateway.ts","src/gateways/notification.gateway.ts:106","Development Team","Implemented","this.connectedUsers.delete(userId);"
"","","consent.service.ts","src/modules/auth/services/consent.service.ts:251","","Implemented","async deleteAllUserConsents(userId: string): Promise<void> {"
"","","consent.service.ts","src/modules/auth/services/consent.service.ts:259","","Implemented","this.logger.log(`All consents deleted for user ${userId}`);"
"","","consent.service.ts","src/modules/auth/services/consent.service.ts:261","","Implemented","this.logger.error(`Failed to delete user consents: ${error.message}`, error.stack);"
"","","user.controller.ts","src/modules/user/user.controller.ts:104","","Implemented","return this.userService.deleteAddress(userId, addressId);"
"","","... and 2 more","","","Implemented",""
"DSR-03","Right to Rectification","auth.controller.ts","src/modules/auth/auth.controller.ts:49","Development Team","Implemented","async updateProfile("
"","","auth.controller.ts","src/modules/auth/auth.controller.ts:53","","Implemented","return this.authService.updateProfile(userId, updateDto);"
"","","auth.service.ts","src/modules/auth/auth.service.ts:93","","Implemented","async updateProfile(userId: string, updateDto: Partial<RegisterDto>) {"
"","","driver.controller.ts","src/modules/driver/driver.controller.ts:90","","Implemented","async updateProfile("
"","","driver.controller.ts","src/modules/driver/driver.controller.ts:94","","Implemented","return this.driverService.updateProfile(driverId, body);"
"","","... and 9 more","","","Implemented",""
"DSR-04","Right to Data Portability","app.controller.ts","src/app.controller.ts:5","Development Team","Implemented","export class AppController {"
"","","app.module.ts","src/app.module.ts:171","","Implemented","export class AppModule implements NestModule {"
"","","app.service.ts","src/app.service.ts:4","","Implemented","export class AppService {"
"","","throttler.config.ts","src/common/config/throttler.config.ts:7","","Implemented","export const ThrottlerConfig = {"
"","","auth.decorator.ts","src/common/decorators/auth.decorator.ts:10","","Implemented","export const Auth = (type: AuthType = AuthType.JWT) =>"
"","","... and 503 more","","","Implemented",""
"SEC-01","Access Control","roles.guard.ts","src/common/guards/roles.guard.ts:28","Security Team","Implemented","export class RolesGuard implements CanActivate {"
"","","admin.controller.ts","src/modules/admin/admin.controller.ts:14","","Implemented","import { RolesGuard } from '../../common/guards/roles.guard';"
"","","admin.controller.ts","src/modules/admin/admin.controller.ts:21","","Implemented","@UseGuards(UnifiedAuthGuard, RolesGuard)"
"","","admin.controller.ts","src/modules/admin/admin.controller.ts:23","","Implemented","@Roles('admin', 'superadmin')"
"","","admin.controller.ts","src/modules/admin/admin.controller.ts:1390","","Implemented","@Roles('superadmin')"
"","","... and 239 more","","","Implemented",""
"SEC-02","Authentication","app.module.ts","src/app.module.ts:45","Security Team","Implemented","import jwtConfig from './config/jwt.config';"
"","","app.module.ts","src/app.module.ts:54","","Implemented","load: [databaseConfig, cacheConfig, firebaseConfig, jwtConfig, appConfig],"
"","","auth.decorator.ts","src/common/decorators/auth.decorator.ts:10","","Implemented","export const Auth = (type: AuthType = AuthType.JWT) =>"
"","","unified-auth.guard.ts","src/common/guards/unified-auth.guard.ts:1","","Implemented","interface JWTPayload {"
"","","unified-auth.guard.ts","src/common/guards/unified-auth.guard.ts:7","","Implemented","interface VendorJWTPayload {"
"","","... and 369 more","","","Implemented",""
"SEC-03","Session Management","idempotency.middleware.ts","src/common/middleware/idempotency.middleware.ts:13","Security Team","Implemented","// Cache في الذاكرة للسرعة (يمكن استبداله بـ Redis في Production)"
"","","cache.helper.ts","src/common/utils/cache.helper.ts:13","","Implemented","* ملاحظة: يعمل بشكل أفضل مع Redis"
"","","cache.helper.ts","src/common/utils/cache.helper.ts:20","","Implemented","// For Redis: use KEYS pattern matching"
"","","transaction.helper.ts","src/common/utils/transaction.helper.ts:1","","Implemented","import { Connection, ClientSession } from 'mongoose';"
"","","transaction.helper.ts","src/common/utils/transaction.helper.ts:18","","Implemented","*   async (session) => {"
"","","... and 228 more","","","Implemented",""
"SEC-04","Input Validation","pagination.dto.ts","src/common/dto/pagination.dto.ts:1","Security Team","Implemented","import { IsOptional, IsNumber, IsString, Min, Max } from 'class-validator';"
"","","driver.gateway.ts","src/gateways/driver.gateway.ts:11","","Implemented","import { Logger, UsePipes, ValidationPipe } from '@nestjs/common';"
"","","driver.gateway.ts","src/gateways/driver.gateway.ts:185","","Implemented","@UsePipes(new ValidationPipe({ transform: true, whitelist: true }))"
"","","driver.gateway.ts","src/gateways/driver.gateway.ts:215","","Implemented","// البيانات مضمونة صحتها من ValidationPipe"
"","","driver.gateway.ts","src/gateways/driver.gateway.ts:232","","Implemented","@UsePipes(new ValidationPipe({ transform: true, whitelist: true }))"
"","","... and 298 more","","","Implemented",""
"AUD-01","Audit Trail","app.module.ts","src/app.module.ts:11","Compliance Team","Implemented","import { AppLoggerService } from './common/services/logger.service';"
"","","app.module.ts","src/app.module.ts:154","","Implemented","AppLoggerService,"
"","","global-exception.filter.ts","src/common/filters/global-exception.filter.ts:7","","Implemented","Logger,"
"","","global-exception.filter.ts","src/common/filters/global-exception.filter.ts:23","","Implemented","private readonly logger = new Logger(GlobalExceptionFilter.name);"
"","","global-exception.filter.ts","src/common/filters/global-exception.filter.ts:55","","Implemented","this.logger.error('Critical Error:', {"
"","","... and 238 more","","","Implemented",""
"AUD-02","Transaction History","wallet-event.entity.ts","src/modules/wallet/entities/wallet-event.entity.ts:4","Finance Team","Implemented","export enum WalletEventType {"
"","","wallet-event.entity.ts","src/modules/wallet/entities/wallet-event.entity.ts:17","","Implemented","export interface WalletEventMetadata {"
"","","wallet-event.entity.ts","src/modules/wallet/entities/wallet-event.entity.ts:31","","Implemented","@Schema({ timestamps: true, collection: 'wallet_events' })"
"","","wallet-event.entity.ts","src/modules/wallet/entities/wallet-event.entity.ts:32","","Implemented","export class WalletEvent extends Document {"
"","","wallet-event.entity.ts","src/modules/wallet/entities/wallet-event.entity.ts:36","","Implemented","@Prop({ required: true, enum: WalletEventType, index: true })"
"","","... and 198 more","","","Implemented",""
"DP-04","Purpose Limitation","auth.controller.ts","src/modules/auth/auth.controller.ts:118","Legal Team","Implemented","@ApiParam({ name: 'type', enum: ConsentType, description: 'نوع الموافقة' })"
"","","auth.controller.ts","src/modules/auth/auth.controller.ts:138","","Implemented","@ApiQuery({ name: 'type', enum: ConsentType, required: false })"
"","","auth.controller.ts","src/modules/auth/auth.controller.ts:171","","Implemented","@ApiParam({ name: 'type', enum: ConsentType, description: 'نوع الموافقة' })"
"","","user.entity.ts","src/modules/auth/entities/user.entity.ts:67","","Implemented","@Prop({ type: String, enum: ['credit', 'debit'], required: true })"
"","","user.entity.ts","src/modules/auth/entities/user.entity.ts:183","","Implemented","@Prop({ type: String, enum: ['ar', 'en'], default: 'ar' })"
"","","... and 13 more","","","Implemented",""
"DP-05","Data Accuracy","unified-auth.guard.ts","src/common/guards/unified-auth.guard.ts:71","Data Team","Implemented","request.user = await this.validateFirebaseToken(token);"
"","","unified-auth.guard.ts","src/common/guards/unified-auth.guard.ts:74","","Implemented","request.user = await this.validateJWT(token);"
"","","unified-auth.guard.ts","src/common/guards/unified-auth.guard.ts:77","","Implemented","request.user = await this.validateVendorJWT(token);"
"","","unified-auth.guard.ts","src/common/guards/unified-auth.guard.ts:80","","Implemented","request.user = await this.validateMarketerJWT(token);"
"","","unified-auth.guard.ts","src/common/guards/unified-auth.guard.ts:105","","Implemented","private async validateFirebaseToken(token: string) {"
"","","... and 104 more","","","Implemented",""
"TP-01","Third Party Data Sharing","logger.service.ts","src/common/services/logger.service.ts:115","Legal Team","Implemented","logExternalCall(service: string, endpoint: string, duration: number, statusCode?: number, context?: "
"","","logger.service.ts","src/common/services/logger.service.ts:116","","Implemented","this.log(`External API: ${service} - ${endpoint}`, {"
"","","env.validation.ts","src/config/env.validation.ts:107","","Implemented","KURAIMI_API_KEY: Joi.string().optional(),"
"","","env.validation.ts","src/config/env.validation.ts:113","","Implemented","SMS_API_KEY: Joi.string().optional(),"
"","","env.example","env.example:61","","Implemented","KURAIMI_API_KEY=your-kuraimi-api-key"
"","","... and 187 more","","","Implemented",""
"TP-02","Data Processing Agreements","app.module.ts","src/app.module.ts:20","Legal Team","Implemented","import { VendorModule } from './modules/vendor/vendor.module';"
"","","app.module.ts","src/app.module.ts:30","","Implemented","import { MerchantModule } from './modules/merchant/merchant.module';"
"","","app.module.ts","src/app.module.ts:107","","Implemented","VendorModule,"
"","","app.module.ts","src/app.module.ts:127","","Implemented","MerchantModule,"
"","","user-role.enum.ts","src/common/enums/user-role.enum.ts:6","","Implemented","VENDOR = 'vendor',"
"","","... and 419 more","","","Implemented",""
"BR-01","Data Breach Detection","update-vendor.dto.ts","src/modules/vendor/dto/update-vendor.dto.ts:19","Security Team","Implemented","orderAlerts?: boolean;"
"","","update-vendor.dto.ts","src/modules/vendor/dto/update-vendor.dto.ts:20","","Implemented","financialAlerts?: boolean;"
"","","update-vendor.dto.ts","src/modules/vendor/dto/update-vendor.dto.ts:21","","Implemented","marketingAlerts?: boolean;"
"","","vendor.entity.ts","src/modules/vendor/entities/vendor.entity.ts:10","","Implemented","orderAlerts: boolean;"
"","","vendor.entity.ts","src/modules/vendor/entities/vendor.entity.ts:13","","Implemented","financialAlerts: boolean;"
"","","... and 351 more","","","Implemented",""
"BR-02","Incident Response","global-exception.filter.ts","src/common/filters/global-exception.filter.ts:22","Security Team","Implemented","export class GlobalExceptionFilter implements ExceptionFilter {"
"","","global-exception.filter.ts","src/common/filters/global-exception.filter.ts:23","","Implemented","private readonly logger = new Logger(GlobalExceptionFilter.name);"
"","","main.ts","src/main.ts:5","","Implemented","import { GlobalExceptionFilter } from './common/filters/global-exception.filter';"
"","","main.ts","src/main.ts:109","","Implemented","app.useGlobalFilters(new GlobalExceptionFilter());"
"","","email.processor.ts","src/queues/processors/email.processor.ts:1","","Implemented","import { Processor, Process, OnQueueActive, OnQueueCompleted, OnQueueFailed } from '@nestjs/bull';"
"","","... and 5 more","","","Implemented",""
"DOC-01","Privacy Policy","consent.guard.ts","src/common/guards/consent.guard.ts:16","Legal Team","Implemented","* @RequireConsents(ConsentType.PRIVACY_POLICY, ConsentType.TERMS_OF_SERVICE)"
"","","consent.guard.ts","src/common/guards/consent.guard.ts:75","","Implemented","export class PrivacyPolicyConsentGuard implements CanActivate {"
"","","consent.guard.ts","src/common/guards/consent.guard.ts:88","","Implemented","ConsentType.PRIVACY_POLICY,"
"","","consent.guard.ts","src/common/guards/consent.guard.ts:94","","Implemented","missingConsents: [ConsentType.PRIVACY_POLICY],"
"","","consent.guard.ts","src/common/guards/consent.guard.ts:95","","Implemented","code: 'MISSING_PRIVACY_POLICY_CONSENT',"
"","","... and 98 more","","","Implemented",""
"DOC-02","API Documentation","pagination.dto.ts","src/common/dto/pagination.dto.ts:3","Development Team","Implemented","import { ApiPropertyOptional } from '@nestjs/swagger';"
"","","main.ts","src/main.ts:3","","Implemented","import { SwaggerModule, DocumentBuilder } from '@nestjs/swagger';"
"","","main.ts","src/main.ts:127","","Implemented","// Swagger Documentation"
"","","main.ts","src/main.ts:143","","Implemented","const document = SwaggerModule.createDocument(app, config);"
"","","main.ts","src/main.ts:144","","Implemented","SwaggerModule.setup('api/docs', app, document);"
"","","... and 383 more","","","Implemented",""
"PDPL-01","Arabic Language Support","response.dto.ts","src/common/dto/response.dto.ts:9","Localization Team","Implemented","userMessage?: string; // رسالة بالعربي للمستخدم"
"","","global-exception.filter.ts","src/common/filters/global-exception.filter.ts:16","","Implemented","userMessage?: string;"
"","","global-exception.filter.ts","src/common/filters/global-exception.filter.ts:43","","Implemented","userMessage: this.getUserMessage(exc, status),"
"","","global-exception.filter.ts","src/common/filters/global-exception.filter.ts:93","","Implemented","private getUserMessage("
"","","global-exception.filter.ts","src/common/filters/global-exception.filter.ts:120","","Implemented","(exception?.userMessage as string) ||"
"","","... and 161 more","","","Implemented",""
"PDPL-02","Local Data Storage","app.module.ts","src/app.module.ts:42","Infrastructure Team","Implemented","import databaseConfig from './config/database.config';"
"","","app.module.ts","src/app.module.ts:54","","Implemented","load: [databaseConfig, cacheConfig, firebaseConfig, jwtConfig, appConfig],"
"","","app.module.ts","src/app.module.ts:63","","Implemented","// Database Module"
"","","app.module.ts","src/app.module.ts:66","","Implemented","uri: process.env.MONGODB_URI || 'mongodb://localhost:27017/bthwani',"
"","","logger.service.ts","src/common/services/logger.service.ts:101","","Implemented","* Log database query"
"","","... and 38 more","","","Implemented",""
